<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DearDiary - Your Safe Space</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700;900&family=Raleway:wght@300;400;500;600&family=Dancing+Script:wght@400;700&family=Caveat:wght@400;700&family=Indie+Flower&family=Shadows+Into+Light&display=swap" rel="stylesheet">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-bg: #f5dcd4;
            --secondary-bg: #fcf9e8;
            --cream: #fffde8;
            --brown: #5c3d3d;
            --dark-brown: #4a2f2f;
            --mauve: #d4c0b8;
            --text-dark: #4a2f2f;
            --paper-bg: #faf8f3;
        }

        body {
            font-family: 'Raleway', sans-serif;
            background-color: var(--primary-bg);
            color: var(--text-dark);
            overflow-x: hidden;
        }

        .page {
            display: none;
        }

        .page.active {
            display: block;
        }

        /* Header */
        header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem 4%;
            background: rgba(245, 220, 212, 0.95);
            backdrop-filter: blur(10px);
            z-index: 1000;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            border-radius: 0 0 30px 30px;
        }

        .logo {
            cursor: pointer;
            transition: transform 0.3s ease;
            height: 120px;
        }

        .logo img {
            height: 100%;
            width: auto;
            transition: transform 0.3s ease;
        }

        .logo:hover img {
            transform: scale(1.2);
        }

        /* Profile Avatar in Nav */
        .profile-avatar {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--brown), var(--dark-brown));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.3s ease;
            overflow: hidden;
        }

        .profile-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .profile-avatar:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 15px rgba(92, 61, 61, 0.3);
        }

        nav ul {
            display: flex;
            list-style: none;
            gap: 1.5rem;
            align-items: center;
        }

        nav a {
            text-decoration: none;
            color: var(--text-dark);
            font-weight: 500;
            font-size: 1.05rem;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            padding: 0.5rem 0;
        }

        nav a::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 0;
            height: 2px;
            background: var(--brown);
            transition: width 0.3s ease;
        }

        nav a:hover {
            color: var(--brown);
        }

        nav a:hover::after {
            width: 100%;
        }

        .btn {
            background: linear-gradient(135deg, var(--brown) 0%, var(--dark-brown) 100%);
            color: white;
            padding: 0.7rem 1.8rem;
            border: none;
            border-radius: 50px;
            font-size: 1.05rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(92, 61, 61, 0.2);
            font-family: 'Raleway', sans-serif;
        }

        .btn:hover {
            transform: translateY(-2px) scale(1.05);
            box-shadow: 0 6px 20px rgba(92, 61, 61, 0.3);
        }

        .btn-secondary {
            background: var(--mauve);
            color: var(--text-dark);
        }

        /* Companion Cat */
        #companion {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 120px;
            height: 120px;
            z-index: 999;
            transition: all 0.8s ease;
        }

        #companion.walking-in {
            animation: walkIn 2s forwards;
        }

        @keyframes walkIn {
            from { right: -150px; }
            to { right: 20px; }
        }

        #companion.nodding {
            animation: nod 0.5s ease-in-out;
        }

        @keyframes nod {
            0%, 100% { transform: rotate(0deg); }
            25% { transform: rotate(-8deg); }
            75% { transform: rotate(8deg); }
        }

        .companion-character {
            width: 100%;
            height: 100%;
            cursor: pointer;
            filter: drop-shadow(0 4px 8px rgba(0,0,0,0.2));
            transition: transform 0.3s ease;
        }

        .companion-character:hover {
            transform: scale(1.1);
        }

        .speech-bubble {
            position: absolute;
            bottom: 130px;
            right: 0;
            background: var(--cream);
            padding: 1.2rem;
            border-radius: 20px;
            box-shadow: 0 8px 25px rgba(92, 61, 61, 0.15);
            max-width: 250px;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.5s ease;
            pointer-events: none;
            border: 2px solid var(--mauve);
        }

        .speech-bubble.show {
            opacity: 1;
            transform: translateY(0);
            pointer-events: all;
        }

        .speech-bubble::after {
            content: '';
            position: absolute;
            bottom: -10px;
            right: 25px;
            width: 20px;
            height: 20px;
            background: var(--cream);
            border-right: 2px solid var(--mauve);
            border-bottom: 2px solid var(--mauve);
            border-radius: 0 0 20px 0;
            transform: rotate(45deg);
        }

        .speech-bubble p {
            margin: 0;
            font-size: 0.9rem;
            color: var(--text-dark);
            line-height: 1.5;
        }

        .close-bubble {
            position: absolute;
            top: 5px;
            right: 8px;
            background: none;
            border: none;
            color: var(--brown);
            font-size: 1.2rem;
            cursor: pointer;
        }

        /* Hero Section */
        .hero-section {
            margin-top: 100px;
            min-height: 85vh;
            display: flex;
            align-items: center;
            padding: 3rem 5%;
            position: relative;
            overflow: hidden;
        }

        .wave-bg {
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            z-index: 0;
        }

        .floating-shapes {
            position: absolute;
            width: 100%;
            height: 100%;
            overflow: hidden;
            z-index: 0;
        }

        .shape {
            position: absolute;
            opacity: 0.3;
            animation: floatShape 20s infinite ease-in-out;
        }

        .shape:nth-child(1) {
            width: 80px;
            height: 80px;
            background: var(--mauve);
            border-radius: 50%;
            top: 20%;
            left: 10%;
        }

        .shape:nth-child(2) {
            width: 120px;
            height: 120px;
            background: var(--cream);
            border-radius: 30% 70% 70% 30% / 30% 30% 70% 70%;
            top: 60%;
            right: 15%;
            animation-delay: 3s;
        }

        .shape:nth-child(3) {
            width: 100px;
            height: 100px;
            background: var(--secondary-bg);
            border-radius: 50%;
            bottom: 20%;
            left: 70%;
            animation-delay: 6s;
        }

        @keyframes floatShape {
            0%, 100% { transform: translate(0, 0) rotate(0deg); }
            33% { transform: translate(30px, -30px) rotate(120deg); }
            66% { transform: translate(-20px, 20px) rotate(240deg); }
        }

        .hero-content {
            position: relative;
            z-index: 1;
            max-width: 900px;
            animation: fadeInUp 1s ease-out;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .hero-content h1 {
            font-family: 'Playfair Display', serif;
            font-size: 3.5rem;
            font-weight: 900;
            line-height: 1.2;
            margin-bottom: 2rem;
            color: var(--brown);
        }

        .hero-content p {
            font-size: 1.3rem;
            margin-bottom: 1rem;
            color: var(--text-dark);
        }

        .hero-content .subtitle {
            font-size: 1.2rem;
            margin-bottom: 2.5rem;
            opacity: 0.9;
        }

        /* What You Get Section */
        .benefits-section {
            padding: 5rem 5%;
            background: var(--cream);
        }

        .benefits-header {
            text-align: center;
            margin-bottom: 4rem;
        }

        .benefits-header h2 {
            font-family: 'Playfair Display', serif;
            font-size: 3rem;
            color: var(--brown);
            margin-bottom: 1rem;
        }

        .benefits-grid {
            max-width: 1200px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 2rem;
        }

        .benefit-card {
            background: white;
            padding: 3rem 2rem;
            border-radius: 30px;
            text-align: center;
            box-shadow: 0 8px 25px rgba(0,0,0,0.08);
            transition: all 0.4s ease;
            min-height: 320px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .benefit-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 15px 40px rgba(92, 61, 61, 0.15);
        }

        .benefit-icon {
            font-size: 4rem;
            margin-bottom: 1.5rem;
            animation: bounce 2s ease-in-out infinite;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .benefit-card:nth-child(1) .benefit-icon { animation-delay: 0s; }
        .benefit-card:nth-child(2) .benefit-icon { animation-delay: 0.2s; }
        .benefit-card:nth-child(3) .benefit-icon { animation-delay: 0.4s; }

        .benefit-card h3 {
            font-family: 'Playfair Display', serif;
            font-size: 1.6rem;
            color: var(--brown);
            margin-bottom: 1rem;
        }

        .benefit-card p {
            font-size: 1.05rem;
            color: var(--text-dark);
            line-height: 1.7;
            opacity: 0.85;
        }

        /* About Section */
        .about-section {
            padding: 5rem 5%;
            background: linear-gradient(180deg, var(--secondary-bg) 0%, var(--cream) 100%);
            position: relative;
        }

        .about-content {
            max-width: 1000px;
            margin: 0 auto;
            text-align: center;
        }

        .about-content h2 {
            font-family: 'Playfair Display', serif;
            font-size: 3rem;
            font-weight: 700;
            font-style: italic;
            margin-bottom: 2rem;
            color: var(--text-dark);
        }

        .about-content p {
            font-size: 1.3rem;
            line-height: 1.8;
            color: var(--text-dark);
        }

        .circle-decor {
            position: absolute;
            border-radius: 50%;
            background: rgba(212, 192, 184, 0.3);
            animation: float 6s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }

        .circle-left {
            width: 150px;
            height: 150px;
            top: -30px;
            left: 0;
        }

        .circle-right {
            width: 200px;
            height: 200px;
            bottom: -50px;
            right: -30px;
            animation-delay: 3s;
        }

        /* Testimonials Section */
        .testimonials-section {
            padding: 5rem 5%;
            background: var(--primary-bg);
        }

        .testimonials-header {
            text-align: center;
            margin-bottom: 4rem;
        }

        .testimonials-header h2 {
            font-family: 'Playfair Display', serif;
            font-size: 3rem;
            color: var(--brown);
            margin-bottom: 1rem;
        }

        .testimonials-grid {
            max-width: 1200px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
        }

        .testimonial-card {
            background: var(--cream);
            padding: 2.5rem;
            border-radius: 30px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.08);
            transition: all 0.3s ease;
        }

        .testimonial-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 35px rgba(0,0,0,0.12);
        }

        .testimonial-text {
            font-style: italic;
            font-size: 1.1rem;
            line-height: 1.7;
            margin-bottom: 1.5rem;
            color: var(--text-dark);
        }

        .testimonial-author {
            font-weight: 600;
            color: var(--brown);
        }

        /* Reminder Card */
        .reminder-section {
            padding: 5rem 5%;
            background: var(--secondary-bg);
        }

        .reminder-card {
            background: var(--cream);
            padding: 4rem;
            border-radius: 40px;
            box-shadow: 0 15px 50px rgba(0,0,0,0.12);
            max-width: 900px;
            margin: 0 auto;
        }

        .reminder-card h3 {
            font-family: 'Raleway', sans-serif;
            font-size: 2rem;
            font-weight: 600;
            margin-bottom: 2rem;
            color: var(--text-dark);
            text-align: center;
        }

        .reminder-card blockquote {
            font-family: 'Playfair Display', serif;
            font-size: 2rem;
            font-weight: 700;
            text-align: center;
            color: var(--brown);
            line-height: 1.6;
        }

        /* CTA */
        .cta-section {
            padding: 5rem 5%;
            background: var(--primary-bg);
        }

        .cta-card {
            background: var(--cream);
            padding: 4rem;
            border-radius: 40px;
            max-width: 1200px;
            margin: 0 auto;
            box-shadow: 0 15px 50px rgba(0,0,0,0.1);
            text-align: center;
        }

        .cta-card h2 {
            font-family: 'Playfair Display', serif;
            font-size: 3rem;
            font-weight: 700;
            font-style: italic;
            margin-bottom: 1.5rem;
            color: var(--text-dark);
        }

        .cta-card p {
            font-size: 1.3rem;
            margin-bottom: 2.5rem;
            color: var(--text-dark);
        }

        /* Footer */
        footer {
            padding: 4rem 5% 2rem;
            background: linear-gradient(135deg, var(--brown) 0%, var(--dark-brown) 100%);
            border-radius: 50px 50px 0 0;
            color: white;
            margin-top: 4rem;
        }

        .footer-content {
            max-width: 1200px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 3rem;
            margin-bottom: 3rem;
        }

        .footer-brand .logo {
            height: 120px;
            margin-bottom: 1.5rem;
        }

        .footer-brand .logo img {
            filter: brightness(0) invert(1) opacity(0.9);
        }

        .footer-brand p {
            line-height: 1.8;
            opacity: 0.9;
        }

        .footer-links h4 {
            font-family: 'Playfair Display', serif;
            font-size: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .footer-links a {
            text-decoration: none;
            color: white;
            display: block;
            margin-bottom: 0.8rem;
            transition: all 0.3s ease;
            opacity: 0.9;
            cursor: pointer;
        }

        .footer-links a:hover {
            opacity: 1;
            transform: translateX(5px);
        }

        .footer-copyright {
            text-align: center;
            padding-top: 2rem;
            border-top: 1px solid rgba(255,255,255,0.2);
            opacity: 0.9;
        }

        /* Auth Page */
        .auth-container {
            margin-top: 110px;
            min-height: calc(100vh - 110px);
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 3rem 5%;
        }

        .auth-box {
            background: var(--cream);
            padding: 3rem;
            border-radius: 35px;
            box-shadow: 0 15px 50px rgba(0,0,0,0.12);
            max-width: 500px;
            width: 100%;
        }

        .auth-box h2 {
            font-family: 'Playfair Display', serif;
            font-size: 2.5rem;
            margin-bottom: 2rem;
            text-align: center;
            color: var(--brown);
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--text-dark);
        }

        .form-group input, .form-group textarea, .form-group select {
            width: 100%;
            padding: 1rem;
            border: 2px solid var(--mauve);
            border-radius: 20px;
            font-size: 1rem;
            font-family: 'Raleway', sans-serif;
            transition: border-color 0.3s ease;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }

        .form-group input:focus, .form-group textarea:focus, .form-group select:focus {
            outline: none;
            border-color: var(--brown);
        }

        .error-message {
            color: #d9534f;
            font-size: 0.9rem;
            margin-top: 0.5rem;
            display: none;
        }

        .auth-toggle {
            text-align: center;
            margin-top: 1.5rem;
        }

        .auth-toggle a {
            color: var(--brown);
            cursor: pointer;
            text-decoration: underline;
        }

        /* Profile Page */
        .profile-container {
            margin-top: 110px;
            min-height: calc(100vh - 110px);
            padding: 3rem 5%;
        }

        .profile-content {
            max-width: 800px;
            margin: 0 auto;
            background: var(--cream);
            padding: 3rem;
            border-radius: 35px;
            box-shadow: 0 15px 50px rgba(0,0,0,0.12);
        }

        .profile-header {
            text-align: center;
            margin-bottom: 3rem;
        }

        .profile-pic-container {
            width: 120px;
            height: 120px;
            margin: 0 auto 1.5rem;
            position: relative;
        }

        .profile-pic {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--brown), var(--dark-brown));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 3rem;
            font-weight: 600;
            overflow: hidden;
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }

        .profile-pic img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .profile-pic-upload {
            position: absolute;
            bottom: 0;
            right: 0;
            width: 40px;
            height: 40px;
            background: var(--brown);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: white;
            font-size: 1.2rem;
            transition: all 0.3s ease;
        }

        .profile-pic-upload:hover {
            transform: scale(1.1);
            background: var(--dark-brown);
        }

        .profile-greeting {
            font-family: 'Playfair Display', serif;
            font-size: 2rem;
            color: var(--brown);
            margin-bottom: 0.5rem;
        }

        /* Diary Page - BEAUTIFUL */
        .diary-container {
            margin-top: 110px;
            min-height: calc(100vh - 110px);
            padding: 3rem 5%;
        }

        .diary-header {
            max-width: 1200px;
            margin: 0 auto 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .diary-header h1 {
            font-family: 'Playfair Display', serif;
            font-size: 2.5rem;
            color: var(--brown);
        }

        .diary-tabs {
            max-width: 1200px;
            margin: 0 auto 2rem;
            display: flex;
            gap: 1rem;
        }

        .tab-btn {
            background: var(--mauve);
            color: var(--text-dark);
            padding: 0.75rem 2rem;
            border: none;
            border-radius: 30px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .tab-btn.active {
            background: var(--brown);
            color: white;
        }

        .diary-content {
            max-width: 1200px;
            margin: 0 auto;
        }

        /* BEAUTIFUL JOURNAL */
        .diary-journal {
            background: linear-gradient(135deg, #fdfbf7 0%, #f9f6f0 100%);
            border-radius: 35px;
            box-shadow: 
                0 10px 30px rgba(0,0,0,0.1),
                inset 0 1px 0 rgba(255,255,255,0.5);
            border: 1px solid #e8dcc8;
            overflow: hidden;
        }

        .journal-header {
            background: linear-gradient(135deg, var(--brown) 0%, var(--dark-brown) 100%);
            padding: 2rem 3rem;
            border-bottom: 3px solid #8b6f47;
        }

        .journal-date {
            font-family: 'Dancing Script', cursive;
            font-size: 1.8rem;
            color: white;
            text-align: center;
            margin-bottom: 0.5rem;
        }

        .journal-greeting {
            font-family: 'Playfair Display', serif;
            font-size: 1.2rem;
            color: rgba(255,255,255,0.9);
            text-align: center;
            font-style: italic;
        }

        /* Enhanced Formatting Toolbar */
        .formatting-toolbar {
            padding: 1.2rem 2rem;
            background: rgba(232, 220, 200, 0.3);
            border-bottom: 1px solid var(--mauve);
            display: flex;
            gap: 1.5rem;
            align-items: center;
            flex-wrap: wrap;
        }

        .toolbar-group {
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }

        .toolbar-label {
            font-weight: 500;
            color: var(--text-dark);
            font-size: 0.9rem;
            margin-right: 0.3rem;
        }

        .font-select {
            padding: 0.5rem 1rem;
            border: 2px solid var(--mauve);
            border-radius: 15px;
            background: white;
            cursor: pointer;
        }

        .color-input {
            width: 45px;
            height: 35px;
            border: 2px solid var(--mauve);
            border-radius: 10px;
            cursor: pointer;
        }

        .slider-input {
            width: 100px;
        }

        .format-btn {
            width: 35px;
            height: 35px;
            border: 2px solid var(--mauve);
            background: white;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: var(--text-dark);
            transition: all 0.3s ease;
        }

        .format-btn:hover {
            background: var(--mauve);
            transform: scale(1.1);
        }

        .format-btn.active {
            background: var(--brown);
            color: white;
            border-color: var(--brown);
        }

        /* Media Tools */
        .media-tools {
            padding: 1rem 2rem;
            background: rgba(232, 220, 200, 0.2);
            border-bottom: 1px solid var(--mauve);
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .media-btn {
            padding: 0.6rem 1.2rem;
            background: white;
            border: 2px solid var(--mauve);
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.95rem;
        }

        .media-btn:hover {
            background: var(--mauve);
            transform: translateY(-2px);
        }

        /* Emoji Picker */
        .emoji-picker-container {
            position: relative;
        }

        .emoji-picker-panel {
            position: absolute;
            top: 50px;
            left: 0;
            background: white;
            border: 2px solid var(--mauve);
            border-radius: 20px;
            padding: 1.5rem;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            display: none;
            z-index: 100;
            width: 400px;
        }

        .emoji-picker-panel.show {
            display: block;
        }

        .emoji-categories {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
            border-bottom: 2px solid var(--mauve);
            padding-bottom: 0.5rem;
        }

        .emoji-category-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 10px;
            transition: background 0.3s ease;
        }

        .emoji-category-btn:hover {
            background: var(--mauve);
        }

        .emoji-grid {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            gap: 0.3rem;
            max-height: 250px;
            overflow-y: auto;
        }

        .emoji-item {
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0.4rem;
            border-radius: 8px;
            text-align: center;
            transition: all 0.2s ease;
        }

        .emoji-item:hover {
            background: var(--mauve);
            transform: scale(1.2);
        }

        /* Journal Editor */
        .journal-page {
            padding: 3rem;
            min-height: 500px;
            position: relative;
            background: 
                linear-gradient(90deg, transparent 0, transparent 58px, rgba(139, 69, 19, 0.08) 58px, rgba(139, 69, 19, 0.08) 60px, transparent 60px),
                repeating-linear-gradient(
                    transparent,
                    transparent 39px,
                    rgba(139, 69, 19, 0.1) 39px,
                    rgba(139, 69, 19, 0.1) 40px
                );
        }

        .journal-editor {
            width: 100%;
            min-height: 450px;
            padding: 0 0 0 80px;
            border: none;
            background: transparent;
            font-family: 'Dancing Script', cursive;
            font-size: 1.4rem;
            line-height: 40px;
            color: var(--text-dark);
            outline: none;
            position: relative;
            z-index: 1;
        }

        .journal-editor:empty::before {
            content: attr(data-placeholder);
            color: rgba(74, 47, 47, 0.3);
            font-style: italic;
        }

        .journal-editor img {
            max-width: 250px;
            border-radius: 15px;
            margin: 0.5rem;
            box-shadow: 0 4px 15px rgba(0,0,0,0.15);
            cursor: move;
            transition: all 0.3s ease;
        }

        .journal-editor img:hover {
            box-shadow: 0 8px 25px rgba(0,0,0,0.25);
            transform: scale(1.05);
        }

        .slider-input {
            width: 100px;
            -webkit-appearance: none;
            appearance: none;
            height: 6px;
            background: var(--mauve);
            border-radius: 10px;
            outline: none;
        }

        .slider-input::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 18px;
            height: 18px;
            background: var(--brown);
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .slider-input::-webkit-slider-thumb:hover {
            background: var(--dark-brown);
            transform: scale(1.2);
        }

        .slider-input::-moz-range-thumb {
            width: 18px;
            height: 18px;
            background: var(--brown);
            border-radius: 50%;
            cursor: pointer;
            border: none;
        }

        .slider-input::-moz-range-thumb:hover {
            background: var(--dark-brown);
        }
        

        .diary-actions {
            padding: 0 3rem 3rem;
            display: flex;
            gap: 1rem;
            justify-content: center;
        }

        /* Entry Cards */
        .entries-container {
            display: grid;
            grid-template-columns: 1fr;
            gap: 2rem;
        }

        .entry-card {
            background: var(--paper-bg);
            border-radius: 25px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            border: 1px solid #d4c4b0;
            overflow: hidden;
        }

        .entry-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 35px rgba(0,0,0,0.15);
        }

        .entry-card-header {
            background: linear-gradient(135deg, var(--brown) 0%, var(--dark-brown) 100%);
            padding: 1.5rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .entry-date {
            font-family: 'Dancing Script', cursive;
            color: white;
            font-size: 1.2rem;
        }

        .entry-actions {
            display: flex;
            gap: 0.5rem;
        }

        .entry-actions button {
            background: rgba(255,255,255,0.2);
            border: none;
            cursor: pointer;
            font-size: 1.1rem;
            padding: 0.4rem 0.8rem;
            border-radius: 15px;
            transition: all 0.3s ease;
        }

        .entry-actions button:hover {
            background: rgba(255,255,255,0.3);
            transform: scale(1.1);
        }

        .entry-content {
            padding: 2rem;
            color: var(--text-dark);
            line-height: 1.8;
            font-family: 'Dancing Script', cursive;
            font-size: 1.2rem;
        }

        .empty-state {
            text-align: center;
            padding: 4rem 2rem;
        }

        .empty-state h3 {
            font-family: 'Playfair Display', serif;
            font-size: 2rem;
            margin-bottom: 1rem;
            color: var(--brown);
        }

        /* Find Calm - SOOTHING COLORS */
        .calm-content {
            max-width: 1200px;
            margin: 0 auto;
            display: grid;
            gap: 4rem;
            position: relative;
            z-index: 1;
            padding-bottom: 3rem;
        }

        .calm-container {
            margin-top: 110px;
            min-height: calc(100vh - 110px);
            padding: 3rem 5%;
            position: relative;
            overflow: hidden;
            background: linear-gradient(180deg, var(--secondary-bg) 0%, var(--cream) 50%, var(--primary-bg) 100%);
        }

        .calm-header {
            max-width: 1000px;
            margin: 0 auto 3rem;
            text-align: center;
            position: relative;
            z-index: 1;
        }

        .calm-header h1 {
            font-family: 'Playfair Display', serif;
            font-size: 3rem;
            color: var(--brown);
            margin-bottom: 1rem;
        }

        .calm-header p {
            font-size: 1.3rem;
            color: var(--text-dark);
            opacity: 0.9;
            margin-bottom: 2rem;
        }

        /* Breathing Circle */
        .breathing-circle {
            width: 200px;
            height: 200px;
            margin: 0 auto;
            background: radial-gradient(circle, 
                rgba(253, 199, 181, 0.878) 0%,        /* Peachy center - solid */
                rgba(252, 183, 158, 0.95) 40%,    /* Mauve mid */
                rgba(231, 168, 167, 0.9) 70%,     /* Darker mauve */
                rgba(255, 182, 178, 0.85) 100%    /* Deep taupe edge */
            );
            border-radius: 50%;
            animation: breathe 4s ease-in-out infinite;
            box-shadow: 
                0 0 60px rgba(223, 193, 172, 0.6),
                0 0 120px rgba(237, 167, 140, 0.5),
                0 10px 40px rgba(238, 166, 166, 0.3),
                inset 0 0 50px rgba(239, 206, 206, 0.4);
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Playfair Display', serif;
            font-size: 1.5rem;
            color: var(--brown);
            font-weight: 700;
            text-shadow: 
                0 2px 10px rgba(255, 255, 255, 0.8),
                0 0 20px rgba(245, 220, 212, 0.6);
            /* border: 4px solid rgba(255, 255, 255, 0.7); */
        }

        @keyframes breathe {
            0%, 100% {
                transform: scale(1);
                box-shadow: 
                    0 0 60px rgba(223, 193, 172, 0.6),
                    0 0 120px rgba(237, 167, 140, 0.5),
                    0 10px 40px rgba(238, 166, 166, 0.3),
                    inset 0 0 50px rgba(239, 206, 206, 0.4);
            }
            50% {
                transform: scale(1.3);
                box-shadow: 
                    0 0 60px rgba(223, 193, 172, 0.6),
                    0 0 120px rgba(237, 167, 140, 0.5),
                    0 10px 40px rgba(238, 166, 166, 0.3),
                    inset 0 0 50px rgba(239, 206, 206, 0.4);
            }
        }

        .calm-section {
            background: linear-gradient(135deg, 
                rgba(252, 249, 232, 0.98) 0%, 
                rgba(245, 220, 212, 0.95) 50%,
                rgba(232, 213, 196, 0.98) 100%
            );
            padding: 3rem;
            border-radius: 35px;
            box-shadow: 0 15px 50px rgba(92, 61, 61, 0.12);
            position: relative;
            overflow: hidden;
        }

        .calm-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;

            bottom: 0;
            background: 
                radial-gradient(circle at 20% 30%, rgba(212, 192, 184, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(252, 249, 232, 0.15) 0%, transparent 50%);
            animation: glowPulse 8s ease-in-out infinite;
            pointer-events: none;
        }

        @keyframes glowPulse {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 1; }
        }

        .calm-section > * {
            position: relative;
            z-index: 1;
        }

        .calm-section h2 {
            font-family: 'Playfair Display', serif;
            font-size: 2.5rem;
            color: var(--brown);
            margin-bottom: 0.5rem;
            text-align: center;
        }

        
        .timer-display {
            font-family: 'Playfair Display', serif;
            font-size: 5rem;
            color: var(--brown);
            margin: 2rem 0;
        }

        .timer-controls {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
            margin-bottom: 1.5rem;
        }

        .custom-timer-input {
            display: flex;
            gap: 0.5rem;
            justify-content: center;
            align-items: center;
            margin-top: 1rem;
        }

        .custom-timer-input input {
            width: 80px;
            padding: 0.5rem;
            border: 2px solid var(--mauve);
            border-radius: 15px;
            text-align: center;
            font-size: 1rem;
        }

        /* Full Screen Meditation View */
        .meditation-fullscreen {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            z-index: 3000;
            background: linear-gradient(-45deg, 
                #fcf9e8,
                #f5dcd4,
                #e8d5c4,
                #d4c0b8,
                #f5dcd4,
                #fcf9e8
            );
            background-size: 400% 400%;
            animation: meditationGradient 25s ease infinite;
            overflow: hidden;
        }

        @keyframes meditationGradient {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .meditation-fullscreen.active {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        /* Animated glow overlay */
        .meditation-fullscreen::before {
            content: '';
            position: absolute;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 30%, rgba(212, 192, 184, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(252, 249, 232, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 50% 50%, rgba(245, 220, 212, 0.2) 0%, transparent 60%);
            animation: glowPulse 8s ease-in-out infinite;
            pointer-events: none;
        }

        @keyframes glowPulse {
            0%, 100% { 
                opacity: 0.5; 
                transform: scale(1) rotate(0deg); 
            }
            50% { 
                opacity: 0.8; 
                transform: scale(1.3) rotate(180deg); 
            }
        }

        /* Floating particles */
        .meditation-fullscreen::after {
            content: '';
            position: absolute;
            width: 20px;
            height: 20px;
            background: radial-gradient(circle, rgba(212, 192, 184, 0.6), transparent);
            border-radius: 50%;
            animation: floatParticle 12s linear infinite;
            pointer-events: none;
        }

        @keyframes floatParticle {
            0% {
                left: 10%;
                top: 110%;
                transform: scale(0);
                opacity: 0;
            }
            10% {
                opacity: 0.8;
                transform: scale(1);
            }
            90% {
                opacity: 0.8;
            }
            100% {
                left: 90%;
                top: -10%;
                transform: scale(1.5);
                opacity: 0;
            }
        }

        .meditation-display {
            text-align: center;
            position: relative;
            z-index: 10;
        }

        .meditation-display .timer-display {
            font-size: 9rem;
            color: var(--brown);
            text-shadow: 
                0 0 40px rgba(252, 249, 232, 1),
                0 0 80px rgba(245, 220, 212, 0.8),
                0 4px 20px rgba(92, 61, 61, 0.3);
            animation: timerGlow 3s ease-in-out infinite;
            font-family: 'Playfair Display', serif;
            font-weight: 700;
        }

        @keyframes timerGlow {
            0%, 100% { 
                text-shadow: 
                    0 0 40px rgba(252, 249, 232, 1),
                    0 0 80px rgba(245, 220, 212, 0.8),
                    0 4px 20px rgba(92, 61, 61, 0.3);
                transform: scale(1);
            }
            50% { 
                text-shadow: 
                    0 0 60px rgba(252, 249, 232, 1),
                    0 0 120px rgba(245, 220, 212, 1),
                    0 8px 40px rgba(92, 61, 61, 0.4);
                transform: scale(1.05);
            }
        }

        .meditation-display .breathe-text {
            font-family: 'Playfair Display', serif;
            font-size: 3.5rem;
            color: var(--dark-brown);
            margin-top: 3rem;
            font-style: italic;
            text-shadow: 0 0 30px rgba(252, 249, 232, 0.9);
            animation: breatheTextPulse 4s ease-in-out infinite;
        }

        @keyframes breatheTextPulse {
            0%, 100% { 
                opacity: 0.85; 
                transform: scale(1); 
            }
            50% { 
                opacity: 1; 
                transform: scale(1.2); 
            }
        }

        /* Ripple circles */
        .meditation-display::before,
        .meditation-display::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            border: 3px solid rgba(212, 192, 184, 0.4);
            border-radius: 50%;
            pointer-events: none;
        }

        .meditation-display::before {
            width: 400px;
            height: 400px;
            margin-left: -200px;
            margin-top: -200px;
            animation: rippleEffect 4s ease-out infinite;
        }

        .meditation-display::after {
            width: 400px;
            height: 400px;
            margin-left: -200px;
            margin-top: -200px;
            animation: rippleEffect 4s ease-out infinite 2s;
        }

        @keyframes rippleEffect {
            0% {
                transform: scale(0.5);
                opacity: 1;
            }
            100% {
                transform: scale(2.5);
                opacity: 0;
            }
        }

        .exit-meditation {
            position: absolute;
            top: 2rem;
            right: 2rem;
            background: rgba(92, 61, 61, 0.4);
            border: 2px solid rgba(92, 61, 61, 0.6);
            color: var(--brown);
            padding: 1rem 2rem;
            border-radius: 30px;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: 600;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            z-index: 20;
        }

        .exit-meditation:hover {
            background: rgba(92, 61, 61, 0.6);
            transform: scale(1.05);
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
        }

        .meditation-controls {
            margin-top: 3rem;
            display: flex;
            gap: 1.5rem;
            position: relative;
            z-index: 10;
        }

        .meditation-controls .btn {
            background: rgba(92, 61, 61, 0.5);
            border: 2px solid var(--brown);
            color: white;
            backdrop-filter: blur(10px);
            min-width: 120px;
            font-size: 1.1rem;
        }

        .meditation-controls .btn:hover {
            background: rgba(92, 61, 61, 0.7);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
        }

        /* Gratitude */
        .gratitude-input {
            width: 100%;
            padding: 1.2rem;
            border: 2px solid var(--mauve);
            border-radius: 25px;
            font-family: 'Raleway', sans-serif;
            font-size: 1.05rem;
            transition: all 0.3s ease;
            background: white;
        }

        .gratitude-input:focus {
            outline: none;
            border-color: var(--brown);
            box-shadow: 0 0 20px rgba(92, 61, 61, 0.15);
        }

        .gratitude-input::placeholder {
            color: rgba(74, 47, 47, 0.4);
            font-style: italic;
        }


        .gratitude-list {
            margin-top: 2rem;
            display: grid;
            gap: 1rem;
            max-height: 400px;
            overflow-y: auto;
            padding-right: 0.5rem;
        }

        .gratitude-list::-webkit-scrollbar {
            width: 10px;
        }

        .gratitude-list::-webkit-scrollbar-track {
            background: rgba(212, 192, 184, 0.2);
            border-radius: 10px;
        }

        .gratitude-list::-webkit-scrollbar-thumb {
            background: var(--mauve);
            border-radius: 10px;
        }

        .gratitude-list::-webkit-scrollbar-thumb:hover {
            background: var(--brown);
        }

        .gratitude-item {
            background: linear-gradient(135deg, rgba(252, 249, 232, 0.9), rgba(245, 220, 212, 0.7));
            padding: 1.3rem;
            border-radius: 18px;
            border-left: 5px solid var(--brown);
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(92, 61, 61, 0.08);
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .gratitude-item:hover {
            transform: translateX(8px);
            box-shadow: 0 6px 20px rgba(92, 61, 61, 0.15);
            border-left-width: 7px;
            background: linear-gradient(135deg, rgba(252, 249, 232, 1), rgba(245, 220, 212, 0.9));
        }

        .gratitude-item strong {
            color: var(--brown);
            font-size: 1.05rem;
            display: block;
            margin-bottom: 0.5rem;
        }

        .gratitude-item div {
            font-size: 0.85rem;
            opacity: 0.7;
            color: var(--text-dark);
        }

        .quote-display {
            background: linear-gradient(135deg, white 0%, rgba(252, 249, 232, 0.5) 100%);
            padding: 3.5rem 3rem;
            border-radius: 25px;
            margin-bottom: 2rem;
            min-height: 250px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 3px solid var(--mauve);
            box-shadow: 
                0 8px 25px rgba(92, 61, 61, 0.1),
                inset 0 0 30px rgba(252, 249, 232, 0.5);
            position: relative;
            overflow: hidden;
        }

        .quote-display::before {
            content: '"';
            position: absolute;
            top: 0.5rem;
            left: 1rem;
            font-size: 7rem;
            color: rgba(212, 192, 184, 0.2);
            font-family: 'Playfair Display', serif;
            line-height: 1;
        }

        .quote-display::after {
            content: '"';
            position: absolute;
            bottom: 0.5rem;
            right: 1rem;
            font-size: 7rem;
            color: rgba(212, 192, 184, 0.2);
            font-family: 'Playfair Display', serif;
            line-height: 1;
        }

        .quote-text {
            font-family: 'Playfair Display', serif;
            font-size: 1.9rem;
            font-style: italic;
            text-align: center;
            color: var(--brown);
            line-height: 1.7;
            transition: opacity 0.3s ease;
            position: relative;
            z-index: 1;
            font-weight: 500;
        }

        .music-player {
            background: white;
            padding: 2rem;
            border-radius: 25px;
        }

        .music-list {
            display: grid;
            gap: 1rem;
        }

        .music-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1.5rem;
            background: var(--secondary-bg);
            border-radius: 20px;
            transition: all 0.3s ease;
        }

        .music-item:hover {
            background: var(--cream);
            transform: translateX(5px);
        }

        .music-item.playing {
            background: var(--mauve);
            box-shadow: 0 4px 12px rgba(92, 61, 61, 0.2);
        }

        .music-info {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .play-btn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--brown);
            color: white;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            transition: all 0.3s ease;
        }

        .play-btn:hover {
            background: var(--dark-brown);
            transform: scale(1.1);
        }

        .music-title {
            font-weight: 600;
            color: var(--text-dark);
            font-size: 1.1rem;
        }

        /* Contact Page */
        .contact-container {
            margin-top: 110px;
            min-height: calc(100vh - 110px);
            padding: 3rem 5%;
        }

        .contact-header {
            max-width: 1200px;
            margin: 0 auto 3rem;
            text-align: center;
        }

        .contact-header h1 {
            font-family: 'Playfair Display', serif;
            font-size: 3rem;
            color: var(--brown);
            margin-bottom: 1rem;
        }

        .contact-content {
            max-width: 900px;
            margin: 0 auto;
            background: var(--cream);
            padding: 4rem;
            border-radius: 40px;
            box-shadow: 0 15px 50px rgba(0,0,0,0.1);
        }

        .contact-name {
            text-align: center;
            margin-bottom: 3rem;
        }

        .contact-name h2 {
            font-family: 'Playfair Display', serif;
            font-size: 2.5rem;
            color: var(--brown);
            margin-bottom: 0.5rem;
        }

        .contact-info {
            display: grid;
            gap: 2rem;
        }

        .contact-item {
            background: white;
            padding: 2rem;
            border-radius: 25px;
            display: flex;
            align-items: center;
            gap: 1.5rem;
            transition: all 0.3s ease;
        }

        .contact-item:hover {
            transform: translateX(10px);
            box-shadow: 0 8px 25px rgba(92, 61, 61, 0.15);
        }

        .contact-icon {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, var(--brown) 0%, var(--dark-brown) 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            flex-shrink: 0;
        }

        .contact-details h3 {
            font-size: 1.2rem;
            color: var(--brown);
            margin-bottom: 0.5rem;
        }

        .contact-details a {
            color: var(--text-dark);
            text-decoration: none;
        }

        .social-links {
            margin-top: 3rem;
            padding-top: 3rem;
            border-top: 2px solid var(--mauve);
            text-align: center;
        }

        .social-links h3 {
            font-family: 'Playfair Display', serif;
            font-size: 1.8rem;
            color: var(--brown);
            margin-bottom: 2rem;
        }

        .social-icons {
            display: flex;
            justify-content: center;
            gap: 1.5rem;
        }

        .social-icon {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, var(--brown) 0%, var(--dark-brown) 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .social-icon:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(92, 61, 61, 0.3);
        }

        .social-icon svg {
            width: 24px;
            height: 24px;
            fill: white;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            backdrop-filter: blur(5px);
            align-items: center;
            justify-content: center;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: var(--cream);
            padding: 3rem;
            border-radius: 30px;
            max-width: 500px;
            text-align: center;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .modal-content h3 {
            font-family: 'Playfair Display', serif;
            font-size: 2rem;
            color: var(--brown);
            margin-bottom: 1rem;
        }

        .modal-content p {
            font-size: 1.1rem;
            margin-bottom: 2rem;
            color: var(--text-dark);
        }

        .modal-actions {
            display: flex;
            gap: 1rem;
            justify-content: center;
        }

        /* Toast */
        .toast {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            padding: 1.5rem 2.5rem;
            border-radius: 25px;
            box-shadow: 0 12px 35px rgba(0,0,0,0.25);
            opacity: 0;
            transform: translateY(100px);
            transition: all 0.4s ease;
            z-index: 2000;
            font-weight: 500;
            min-width: 280px;
        }

        .toast.show {
            opacity: 1;
            transform: translateY(0);
        }

        .toast.success {
            background: linear-gradient(135deg, #e8f5e9, #c8e6c9);
            border: 2px solid #81c784;
            color: #2e7d32;
        }

        .toast.error {
            background: linear-gradient(135deg, #ffebee, #ffcdd2);
            border: 2px solid #e57373;
            color: #c62828;
        }

        .toast.info {
            background: linear-gradient(135deg, var(--cream), var(--secondary-bg));
            border: 2px solid var(--mauve);
            color: var(--brown);
        }

        .menu-toggle {
            display: none;
        }

        /* Mobile */
        @media (max-width: 768px) {
            .logo {
                height: 70px;
            }

            nav ul {
                flex-direction: column;
                position: fixed;
                top: 100px;
                right: -100%;
                background: var(--primary-bg);
                width: 70%;
                height: calc(100vh - 100px);
                padding: 2rem;
                transition: right 0.3s ease;
                box-shadow: -5px 0 20px rgba(0,0,0,0.1);
                border-radius: 25px 0 0 25px;
            }

            nav ul.active {
                right: 0;
            }

            .menu-toggle {
                display: block;
                font-size: 1.5rem;
                cursor: pointer;
                color: var(--brown);
            }

            .hero-content h1 {
                font-size: 2.5rem;
            }

            .benefits-grid {
                grid-template-columns: 1fr;
            }

            .footer-content {
                grid-template-columns: 1fr;
            }

            .formatting-toolbar {
                gap: 0.8rem;
            }

            .breathing-circle {
                width: 150px;
                height: 150px;
            }

            #companion {
                width: 90px;
                height: 90px;
            }

            .emoji-picker-panel {
                width: 300px;
            }

            .timer-display {
                font-size: 3.5rem;
            }
        }
        /* DIARY BOOK FEATURE */
        .diary-management {
            margin-bottom: 3rem;
        }

        #viewTab {
            display: none;
        }

        #viewTab.active {
            display: grid !important;
        }

        .create-diary-section {
            background: linear-gradient(135deg, var(--cream), var(--secondary-bg));
            padding: 2.5rem;
            border-radius: 30px;
            margin-bottom: 2rem;
            box-shadow: 0 8px 25px rgba(92, 61, 61, 0.1);
            border: 2px solid var(--mauve);
        }

        .create-diary-section h3 {
            font-family: 'Playfair Display', serif;
            font-size: 2rem;
            color: var(--brown);
            margin-bottom: 1.5rem;
            text-align: center;
        }


        .diary-form {
            display: grid;
            gap: 1.5rem;
        }

        .diary-form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .diary-form input, .diary-form select {
            padding: 1rem;
            border: 2px solid var(--mauve);
            border-radius: 20px;
            font-family: 'Raleway', sans-serif;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: white;
        }

        .diary-form input:focus, .diary-form select:focus {
            outline: none;
            border-color: var(--brown);
            box-shadow: 0 0 15px rgba(92, 61, 61, 0.15);
        }

        .color-picker-group {
            display: flex;
            gap: 1rem;
            align-items: center;
            flex-wrap: wrap;
            justify-content: center;
            padding: 1rem;
            background: white;
            border-radius: 20px;
        }

        .color-option {
            width: 55px;
            height: 55px;
            border-radius: 50%;
            cursor: pointer;
            border: 4px solid transparent;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .color-option:hover {
            transform: scale(1.15);
            box-shadow: 0 6px 18px rgba(0,0,0,0.15);
        }

        .color-option.selected {
            border-color: var(--brown);
            box-shadow: 0 0 20px rgba(92, 61, 61, 0.4);
            transform: scale(1.1);
        }

        .diaries-panel {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 2rem;
            margin-bottom: 3rem;
            padding: 2rem 0;
        }

        .diaries-panel:empty::before {
            content: 'No diary books created yet. Create one above to compile your entries!';
            grid-column: 1 / -1;
            text-align: center;
            padding: 3rem;
            color: var(--text-dark);
            opacity: 0.6;
            font-style: italic;
        }

        .diary-book-card {
            background: white;
            padding: 2.5rem 2rem;
            border-radius: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.12);
            cursor: pointer;
            transition: all 0.4s ease;
            border: 4px solid;
            position: relative;
            overflow: hidden;
        }

        .diary-book-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, transparent 0%, var(--mauve) 100%);
            opacity: 0;
            transition: opacity 0.4s ease;
        }

        .diary-book-card:hover {
            transform: translateY(-10px) rotate(-3deg);
            box-shadow: 0 20px 50px rgba(0,0,0,0.25);
        }

        .diary-book-card:hover::before {
            opacity: 0.1;
        }

        .diary-book-card h4 {
            font-family: 'Playfair Display', serif;
            font-size: 1.7rem;
            color: var(--brown);
            margin-bottom: 1rem;
            position: relative;
            z-index: 1;
        }

        .diary-book-card p {
            font-size: 1rem;
            color: var(--text-dark);
            opacity: 0.8;
            margin-bottom: 0.5rem;
            position: relative;
            z-index: 1;
        }

        .diary-book-spine {
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 12px;
            border-radius: 25px 0 0 25px;
        }

        .diary-actions-mini {
            margin-top: 1.5rem;
            display: flex;
            gap: 0.5rem;
            position: relative;
            z-index: 1;
        }

        .diary-actions-mini button {
            background: white;
            border: 2px solid var(--mauve);
            padding: 0.5rem 1rem;
            border-radius: 18px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            color: var(--text-dark);
            font-weight: 500;
        }

        .diary-actions-mini button:hover {
            background: var(--mauve);
            transform: scale(1.05);
        }

        /* DIARY READER - PAGE TURNING */
        .diary-reader {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            z-index: 4000;
            background: rgba(0,0,0,0.85);
            backdrop-filter: blur(10px);
            display: none;
            align-items: center;
            justify-content: center;
        }

        .diary-reader.active {
            display: flex;
        }
        
        

        /* Book Container */
        .diary-book {
            width: 90%;
            max-width: 1400px;
            height: 85vh;
            display: flex;
            position: relative;
            perspective: 2500px;
            perspective-origin: 50% 50%;
        }

        /* Book Cover */
        .book-cover {
            position: absolute;
            width: calc(100% - 80px);
            height: 100%;
            right: 0;
            border-radius: 0 20px 20px 0;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: transform 1.2s cubic-bezier(0.645, 0.045, 0.355, 1);
            transform-origin: left center;
            transform-style: preserve-3d;
            z-index: 10;
            box-shadow: 
                0 20px 80px rgba(0,0,0,0.5),
                inset 0 0 50px rgba(0,0,0,0.1);
        }

        .book-cover.opened {
            transform: rotateY(-175deg);
            pointer-events: none;
        }

        .book-cover-front {
            width: 100%;
            height: 100%;
            border-radius: 0 20px 20px 0;
            padding: 4rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            position: relative;
            overflow: hidden;
            backface-visibility: hidden;
        }

        .book-cover-front::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 30% 30%, rgba(255,255,255,0.2) 0%, transparent 50%),
                radial-gradient(circle at 70% 70%, rgba(0,0,0,0.1) 0%, transparent 50%);
            pointer-events: none;
        }

        .book-cover-front > * {
            position: relative;
            z-index: 1;
        }


        .book-cover-title {
            font-family: 'Playfair Display', serif;
            font-size: 4rem;
            color: white;
            margin-bottom: 2rem;
            text-shadow: 0 4px 20px rgba(0,0,0,0.3);
            font-weight: 700;
        }

        .book-cover-info {
            font-family: 'Raleway', sans-serif;
            font-size: 1.3rem;
            color: rgba(255,255,255,0.9);
            margin-bottom: 1rem;
        }

        .book-cover-ornament {
            width: 150px;
            height: 150px;
            margin: 2rem 0;
            opacity: 0.3;
        }

        .book-cover-cta {
            margin-top: 3rem;
            font-family: 'Playfair Display', serif;
            font-size: 1.5rem;
            color: rgba(255,255,255,0.8);
            font-style: italic;
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 0.6; }
            50% { opacity: 1; }
        }

        /* Book Spine */
        .book-spine {
            width: 80px;
            background: linear-gradient(90deg, #1a0e08 0%, #2a1810 50%, #1a0e08 100%);
            border-radius: 20px 0 0 20px;
            position: relative;
            box-shadow: 
                inset -10px 0 20px rgba(0,0,0,0.5),
                inset 0 0 50px rgba(0,0,0,0.3);
            z-index: 5;
        }

        .book-spine-title {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) rotate(-90deg);
            font-family: 'Playfair Display', serif;
            color: rgba(255,255,255,0.7);
            font-size: 1.2rem;
            white-space: nowrap;
            text-shadow: 0 2px 10px rgba(0,0,0,0.5);
        }

        /* Book Pages Container */
        .book-pages-container {
            flex: 1;
            position: relative;
            overflow: hidden;
            background: var(--paper-bg);
            border-radius: 0 20px 20px 0;
            box-shadow: 
                0 20px 80px rgba(0,0,0,0.5),
                inset 0 0 100px rgba(139, 69, 19, 0.05);
        }

        /* Individual Pages */
        .book-page {
            position: absolute;
            top: 0;
            width: 50%;
            height: 100%;
            padding: 4rem 3rem;
            background: var(--paper-bg);
            box-shadow: inset 0 0 50px rgba(139, 69, 19, 0.03);
            overflow-y: auto;
        }

        .book-page.left {
            left: 0;
            border-right: 1px solid rgba(139, 69, 19, 0.1);
        }

        .book-page.right {
            right: 0;
        }

        .book-page::-webkit-scrollbar {
            width: 8px;
        }

        .book-page::-webkit-scrollbar-track {
            background: rgba(212, 192, 184, 0.1);
        }

        .book-page::-webkit-scrollbar-thumb {
            background: var(--mauve);
            border-radius: 10px;
        }

        /* Page Content */
        .page-content {
            font-family: 'Dancing Script', cursive;
            font-size: 1.4rem;
            line-height: 1.9;
            color: var(--text-dark);
        }

        .page-content img {
            max-width: 100%;
            border-radius: 15px;
            margin: 1rem 0;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .page-date {
            font-family: 'Playfair Display', serif;
            font-size: 1.4rem;
            color: var(--brown);
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--mauve);
            font-weight: 600;
        }

        .page-number {
            position: absolute;
            bottom: 2rem;
            font-size: 1rem;
            color: var(--text-dark);
            opacity: 0.5;
            font-family: 'Playfair Display', serif;
        }

        .page-number.left {
            left: 3rem;
        }

        .page-number.right {
            right: 3rem;
        }

        /* Book Controls */
        .book-controls {
            position: absolute;
            bottom: 3rem;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 1.5rem;
            align-items: center;
            z-index: 100;
            background: rgba(92, 61, 61, 0.9);
            padding: 1rem 2rem;
            border-radius: 40px;
            backdrop-filter: blur(10px);
        }

        .book-nav-btn {
            background: var(--cream);
            color: var(--brown);
            border: none;
            padding: 0.8rem 1.8rem;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .book-nav-btn:hover:not(:disabled) {
            background: white;
            transform: scale(1.05);
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .book-nav-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        .book-controls span {
            color: white;
            font-size: 1.1rem;
            font-weight: 500;
        }

        .close-reader {
            position: absolute;
            top: 2rem;
            right: 2rem;
            background: var(--brown);
            color: white;
            border: none;
            width: 55px;
            height: 55px;
            border-radius: 50%;
            font-size: 1.8rem;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 100;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }

        .close-reader:hover {
            background: var(--dark-brown);
            transform: scale(1.1) rotate(90deg);
        }


    </style>
</head>
<body>
    <div id="toast" class="toast"></div> <!-- dynamic messages shown here -->

    <!-- Modals -->
    <div id="deleteModal" class="modal">
        <div class="modal-content">
            <h3>Delete Entry?</h3>
            <p>Are you sure you want to delete this entry? This cannot be undone.</p>
            <div class="modal-actions">
                <button class="btn-secondary btn" onclick="cancelDelete()">Cancel</button>
                <button class="btn" onclick="confirmDelete()">Delete</button>
            </div>
        </div>
    </div>

    <div id="loginPromptModal" class="modal">
        <div class="modal-content">
            <h3>Save Your Entry</h3>
            <p>Please login or sign up to save your diary entry.</p>
            <div class="modal-actions">
                <button class="btn-secondary btn" onclick="closeLoginPrompt()">Cancel</button>
                <button class="btn" onclick="goToAuth()">Login / Sign Up</button>
            </div>
        </div>
    </div>

    <!-- Meditation Fullscreen -->
    <div id="meditationFullscreen" class="meditation-fullscreen">
        <button class="exit-meditation" onclick="exitMeditation()"> Exit Fullscreen</button>
        <div class="meditation-display">
            <div class="timer-display" id="fullscreenTimer">05:00</div>
            <div class="breathe-text" id="fullscreenBreathe">Breathe In...</div>
            <div class="meditation-controls">
                <button class="btn" onclick="pauseTimerFromFullscreen()">Pause</button>
                <button class="btn" onclick="stopTimerFromFullscreen()">Stop</button>
            </div>
        </div>
    </div>

    <!-- Companion Cat -->
    <div id="companion">
        <div class="speech-bubble" id="speechBubble">
            <button class="close-bubble" onclick="closeSpeechBubble()"></button>
            <p id="companionMessage"></p>
        </div>
        
        <svg class="companion-character" viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg" onclick="toggleSpeechBubble()">
            <ellipse cx="100" cy="130" rx="55" ry="65" fill="#D4A373"/>
            <circle cx="100" cy="75" r="45" fill="#E8C4A0"/>
            <path d="M 65 40 L 55 10 L 80 45 Z" fill="#D4A373"/>
            <path d="M 65 40 L 60 20 L 75 42 Z" fill="#F5D7B8"/>
            <path d="M 135 40 L 145 10 L 120 45 Z" fill="#D4A373"/>
            <path d="M 135 40 L 140 20 L 125 42 Z" fill="#F5D7B8"/>
            <ellipse cx="85" cy="70" rx="8" ry="12" fill="#3E2723"/>
            <ellipse cx="87" cy="67" rx="3" ry="4" fill="white"/>
            <ellipse cx="115" cy="70" rx="8" ry="12" fill="#3E2723"/>
            <ellipse cx="117" cy="67" rx="3" ry="4" fill="white"/>
            <path d="M 100 85 L 95 90 L 100 92 L 105 90 Z" fill="#C97B63"/>
            <path d="M 100 92 Q 95 95 90 93" stroke="#3E2723" stroke-width="2" fill="none"/>
            <path d="M 100 92 Q 105 95 110 93" stroke="#3E2723" stroke-width="2" fill="none"/>
            <line x1="50" y1="75" x2="75" y2="73" stroke="#3E2723" stroke-width="1.5"/>
            <line x1="50" y1="80" x2="75" y2="80" stroke="#3E2723" stroke-width="1.5"/>
            <line x1="50" y1="85" x2="75" y2="87" stroke="#3E2723" stroke-width="1.5"/>
            <line x1="150" y1="75" x2="125" y2="73" stroke="#3E2723" stroke-width="1.5"/>
            <line x1="150" y1="80" x2="125" y2="80" stroke="#3E2723" stroke-width="1.5"/>
            <line x1="150" y1="85" x2="125" y2="87" stroke="#3E2723" stroke-width="1.5"/>
            <circle cx="75" cy="82" r="6" fill="#F5D7B8" opacity="0.6"/>
            <circle cx="125" cy="82" r="6" fill="#F5D7B8" opacity="0.6"/>
            <ellipse cx="100" cy="145" rx="35" ry="45" fill="#F5E5D3"/>
            <ellipse cx="75" cy="175" rx="12" ry="20" fill="#D4A373"/>
            <ellipse cx="75" cy="185" rx="10" ry="8" fill="#E8C4A0"/>
            <ellipse cx="125" cy="175" rx="12" ry="20" fill="#D4A373"/>
            <ellipse cx="125" cy="185" rx="10" ry="8" fill="#E8C4A0"/>
            <path d="M 145 130 Q 170 120 175 95 Q 178 85 172 82" stroke="#D4A373" stroke-width="18" fill="none" stroke-linecap="round"/>
            <path d="M 100 140 L 95 145 Q 90 150 95 155 Q 100 160 100 160 Q 100 160 105 155 Q 110 150 105 145 Z" fill="#E07A7A" opacity="0.7"/>
        </svg>
    </div>

    <!-- Header -->
    <header>
        <div class="logo" onclick="navigateTo('home')">
            <img src="./assets/images/logo.png" alt="Dear Diary">
        </div>
        <nav>
            <div class="menu-toggle" id="menuToggle"></div>
            <ul id="navMenu">
                <li><a onclick="navigateTo('home')">Home</a></li>
                <li><a onclick="navigateTo('diary')">Let it Out</a></li>
                <li><a onclick="navigateTo('calm')">Find Calm</a></li>
                <li><a onclick="navigateTo('contact')">Contact</a></li>
                <li id="navAuthContainer"></li>
            </ul>
        </nav>
    </header>

    <!-- HOME PAGE -->
    <div id="homePage" class="page active">
        <section class="hero-section">
            <svg class="wave-bg" viewBox="0 0 1200 800" preserveAspectRatio="none">
                <path d="M0,400 Q300,250 600,400 T1200,400 L1200,800 L0,800 Z" fill="#fcf9e8" opacity="0.7"/>
                <path d="M0,500 Q300,350 600,500 T1200,500 L1200,800 L0,800 Z" fill="#f5dcd4" opacity="0.5"/>
            </svg>
            <div class="floating-shapes">
                <div class="shape"></div>
                <div class="shape"></div>
                <div class="shape"></div>
            </div>
            <div class="hero-content">
                <h1>Your Safe Space to Let it All Out, and Find Your Calm Again.</h1>
                <p>Write, save, and reflect on your thoughts every day.</p>
                <p class="subtitle">Start writing when you're ready.</p>
                <button class="btn" onclick="beginDiary()">Begin My Diary</button>
            </div>
        </section>

        <!-- What You Get -->
        <section class="benefits-section">
            <div class="benefits-header">
                <h2>What You'll Get with DearDiary</h2>
                <p>Everything you need for your wellness journey</p>
            </div>
            <div class="benefits-grid">
                <div class="benefit-card">
                    <div class="benefit-icon"></div>
                    <h3>Rich Text Editor</h3>
                    <p>Express yourself with fonts, colors, emojis, images, and even drawings. Make every entry uniquely yours.</p>
                </div>
                <div class="benefit-card">
                    <div class="benefit-icon"></div>
                    <h3>100% Private</h3>
                    <p>Your thoughts are encrypted and secure. Only you can access your entries. No one else.</p>
                </div>
                <div class="benefit-card">
                    <div class="benefit-icon"></div>
                    <h3>Calm Tools</h3>
                    <p>Meditation timer, breathing exercises, calming music, and daily affirmations to find your peace.</p>
                </div>
            </div>
        </section>

        <section class="about-section">
            <div class="circle-decor circle-left"></div>
            <div class="circle-decor circle-right"></div>
            <div class="about-content">
                <h2>What is DearDiary?</h2>
                <p>DearDiary is your quiet corner on the web  a space to pour your thoughts, release the weight you've been carrying, and rediscover your calm, one word at a time. No judgment, no pressure, just you and your thoughts.</p>
            </div>
        </section>

        <!-- Testimonials -->
        <section class="testimonials-section">
            <div class="testimonials-header">
                <h2>What Our Users Say</h2>
            </div>
            <div class="testimonials-grid">
                <div class="testimonial-card">
                    <p class="testimonial-text">"DearDiary has become my daily ritual. It's the safe space I didn't know I needed."</p>
                    <p class="testimonial-author"> Sarah M.</p>
                </div>
                <div class="testimonial-card">
                    <p class="testimonial-text">"The meditation timer and calming music help me unwind after stressful days. Truly therapeutic."</p>
                    <p class="testimonial-author"> James K.</p>
                </div>
                <div class="testimonial-card">
                    <p class="testimonial-text">"I love the creative freedom - adding images and drawings makes journaling so much more meaningful."</p>
                    <p class="testimonial-author"> Emma L.</p>
                </div>
            </div>
        </section>

        <section class="reminder-section">
            <div class="reminder-card">
                <h3>Gentle Reminder</h3>
                <blockquote>"Take a deep breath. You're allowed to rest before you rise again."</blockquote>
            </div>
        </section>

        <section class="cta-section">
            <div class="cta-card">
                <h2>Ready to Let it Out?</h2>
                <p>Join thousands finding peace through daily reflection.</p>
                <button class="btn" onclick="beginDiary()">Begin My Diary</button>
            </div>
        </section>

        <footer>
            <div class="footer-content">
                <div class="footer-brand">
                    <div class="logo">
                        <img src="./assets/images/logo.png" alt="Dear Diary">
                    </div>
                    <p>Your safe space to let it all out and find your calm again.</p>
                </div>
                <div class="footer-links">
                    <h4>Quick Links</h4>
                    <a onclick="navigateTo('home')">Home</a>
                    <a onclick="navigateTo('diary')">Let it Out</a>
                    <a onclick="navigateTo('calm')">Find Calm</a>
                    <a onclick="navigateTo('contact')">Contact</a>
                </div>
            </div>
            <div class="footer-copyright">
                Made with love by DearDiary | Your thoughts are safe here.
            </div>
        </footer>
    </div>

    <!-- AUTH PAGE -->
    <div id="authPage" class="page">
        <div class="auth-container">
            <div class="auth-box">
                <h2 id="authTitle">Welcome Back</h2>
                
                <form id="loginForm">
                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" id="loginEmail" required>
                    </div>
                    <div class="form-group">
                        <label>Password</label>
                        <input type="password" id="loginPassword" required>
                    </div>
                    <div class="error-message" id="loginError"></div>
                    <button type="submit" class="btn" style="width: 100%;">Login</button>
                </form>

                <form id="signupForm" style="display: none;">
                    <div class="form-group">
                        <label>Full Name</label>
                        <input type="text" id="signupName" required>
                    </div>
                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" id="signupEmail" required>
                    </div>
                    <div class="form-group">
                        <label>Password</label>
                        <input type="password" id="signupPassword" required minlength="6">
                    </div>
                    <div class="form-group">
                        <label>Confirm Password</label>
                        <input type="password" id="signupConfirmPassword" required>
                    </div>
                    <div class="error-message" id="signupError"></div>
                    <button type="submit" class="btn" style="width: 100%;">Sign Up</button>
                </form>

                <div class="auth-toggle">
                    <span id="authToggleText">Don't have an account? </span>
                    <a id="authToggleLink" onclick="toggleAuthForm()">Sign Up</a>
                </div>
            </div>
        </div>
    </div>

    <!-- PROFILE PAGE -->
    <div id="profilePage" class="page">
        <div class="profile-container">
            <div class="profile-content">
                <div class="profile-header">
                    <div class="profile-pic-container">
                        <div class="profile-pic" id="profilePicDisplay"></div>
                        <div class="profile-pic-upload" onclick="document.getElementById('profilePicInput').click()"></div>
                        <input type="file" id="profilePicInput" accept="image/*" style="display: none;">
                    </div>
                    <h1 class="profile-greeting" id="profileGreeting">Hello!</h1>
                </div>
                
                <form id="profileForm">
                    <div class="form-group">
                        <label>Full Name</label>
                        <input type="text" id="profileName" required>
                    </div>
                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" id="profileEmail" readonly>
                    </div>
                    <div class="form-group">
                        <label>Favorite Quote</label>
                        <textarea id="profileQuote" placeholder="What quote inspires you?"></textarea>
                    </div>
                    <div class="form-group">
                        <label>Preferred Writing Time</label>
                        <select id="profileWritingTime">
                            <option>Morning</option>
                            <option>Afternoon</option>
                            <option>Evening</option>
                            <option>Night</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Journaling Goal</label>
                        <select id="profileGoal">
                            <option>Daily reflection</option>
                            <option>Stress relief</option>
                            <option>Personal growth</option>
                            <option>Gratitude practice</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>New Password (leave blank to keep current)</label>
                        <input type="password" id="profileNewPassword" minlength="6">
                    </div>
                    <div class="error-message" id="profileError"></div>
                    <div style="display: flex; gap: 1rem; justify-content: center; margin-top: 2rem;">
                        <button type="submit" class="btn">Update Profile</button>
                        <button type="button" class="btn-secondary btn" onclick="logout()">Logout</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- DIARY PAGE -->
    <div id="diaryPage" class="page">
        <div class="diary-container">
            <div class="diary-header">
                <h1>My Diary</h1>
            </div>

            <div class="diary-tabs">
                <button class="tab-btn active" onclick="switchDiaryTab('write')">Write Entry</button>
                <button class="tab-btn" onclick="switchDiaryTab('view')">View Entries</button>
            </div>

            <div class="diary-content">
                <div id="writeTab" class="diary-journal">
                    <div class="journal-header">
                        <div class="journal-date" id="journalDate"></div>
                        <div class="journal-greeting" id="journalGreeting"></div>
                    </div>
                    
                    <div class="formatting-toolbar">
                        <div class="toolbar-group">
                            <span class="toolbar-label">Font:</span>
                            <select class="font-select" id="fontSelect" onchange="changeFont()">
                                <option value="dancing">Dancing Script</option>
                                <option value="caveat">Caveat</option>
                                <option value="indie">Indie Flower</option>
                                <option value="shadows">Shadows Into Light</option>
                            </select>
                        </div>
                        
                        <div class="toolbar-group">
                            <span class="toolbar-label">Size:</span>
                            <input type="range" class="slider-input" id="sizeSlider" min="12" max="30" value="18" oninput="changeFontSize()">
                            <span id="sizeDisplay">18px</span>
                        </div>
                        
                                                
                        <div class="toolbar-group">
                            <span class="toolbar-label">Color:</span>
                            <input type="color" class="color-input" id="colorInput" value="#4a2f2f" onchange="changeTextColor()">
                        </div>
                        
                        <div class="toolbar-group">
                            <button class="format-btn" id="boldBtn" onclick="toggleFormat('bold')"><strong>B</strong></button>
                            <button class="format-btn" id="italicBtn" onclick="toggleFormat('italic')"><em>I</em></button>
                            <button class="format-btn" id="underlineBtn" onclick="toggleFormat('underline')"><u>U</u></button>
                            <button class="format-btn" id="highlightBtn" onclick="toggleHighlight()">H</button>
                        </div>
                    </div>

                    <div class="media-tools">
                        <button class="media-btn" onclick="document.getElementById('imageInput').click()"> Add Image</button>
                        <div class="emoji-picker-container">
                            <button class="media-btn" onclick="toggleEmojiPicker()"> Emojis</button>
                            <div class="emoji-picker-panel" id="emojiPicker">
                                <div class="emoji-categories">
                                    <button class="emoji-category-btn" onclick="showEmojiCategory('smileys')"></button>
                                    <button class="emoji-category-btn" onclick="showEmojiCategory('nature')"></button>
                                    <button class="emoji-category-btn" onclick="showEmojiCategory('objects')"></button>
                                    <button class="emoji-category-btn" onclick="showEmojiCategory('symbols')"></button>
                                </div>
                                <div class="emoji-grid" id="emojiGrid"></div>
                            </div>
                        </div>
                        <input type="file" id="imageInput" accept="image/*" multiple style="display: none">
                    </div>

                    <div class="journal-page">
                        
                        <div id="diaryEditor" class="journal-editor" contenteditable="true" data-placeholder="Dear Diary,

What's on your mind today?"></div>
                    </div>
                    
                    <div class="diary-actions">
                        <button class="btn" onclick="saveDiaryEntry()">Save Entry</button>
                        <button class="btn-secondary btn" onclick="clearDiaryEditor()">Clear</button>
                    </div>
                </div>

                <div id="viewTab" class="entries-container" style="display: none;"></div>
            </div>
        </div>
    </div>

    <!-- FIND CALM PAGE -->
    <div id="calmPage" class="page">
        <div class="calm-container">
            <div class="calm-header">
                <h1>Find Your Calm</h1>
                <p>Take a moment to breathe, reflect, and restore your peace.</p>
                <div class="breathing-circle"><span id="breatheText">Breathe</span></div>
            </div>

            <div class="calm-content">
                <!-- Meditation Timer -->
                <div class="calm-section">
                    <h2>Meditation Timer</h2>
                    <p style="text-align: center; margin-bottom: 2rem; color: var(--text-dark); opacity: 0.8;">Set your timer and find your inner peace</p>
                    
                    <div class="meditation-timer">
                        <div class="timer-display" id="timerDisplay" style="color: var(--brown);">05:00</div>
                        
                        <div class="timer-controls" style="margin-bottom: 1.5rem;">
                            <button class="btn-secondary btn" onclick="setTimer(3)" style="min-width: 90px;">3 min</button>
                            <button class="btn-secondary btn" onclick="setTimer(5)" style="min-width: 90px;">5 min</button>
                            <button class="btn-secondary btn" onclick="setTimer(10)" style="min-width: 90px;">10 min</button>
                            <button class="btn-secondary btn" onclick="setTimer(15)" style="min-width: 90px;">15 min</button>
                        </div>
                        
                        <div class="custom-timer-input" style="margin-bottom: 2rem;">
                            <span style="color: var(--text-dark); font-weight: 500;">Custom:</span>
                            <input type="number" id="customMinutes" min="1" max="60" placeholder="Minutes" style="width: 100px; padding: 0.6rem; border: 2px solid var(--mauve); border-radius: 15px; text-align: center;">
                            <button class="btn-secondary btn" onclick="setCustomTimer()">Set</button>
                        </div>
                        
                        <div style="display: flex; gap: 1rem; justify-content: center;">
                            <button class="btn" onclick="startMeditation()" id="timerBtn" style="min-width: 180px; font-size: 1.1rem;">Start Meditation</button>
                            <button class="btn-secondary btn" onclick="resetTimer()" style="min-width: 100px;">Reset</button>
                        </div>
                    </div>
                </div>

                

                <!-- Daily Affirmation -->
                <div class="calm-section">
                    <h2>Daily Affirmation</h2>
                    <p style="text-align: center; color: var(--text-dark); opacity: 0.8; margin-bottom: 2rem;">Words to uplift and inspire you</p>
                    
                    <div class="quote-display">
                        <p class="quote-text" id="calmQuote"></p>
                    </div>
                    
                    <div style="text-align: center; margin-top: 1.5rem;">
                        <button class="btn" onclick="getNewQuote()">New Quote</button>
                    </div>
                    
                    <div style="margin-top: 2rem; padding-top: 2rem; border-top: 2px solid var(--mauve);">
                        <p style="text-align: center; color: var(--text-dark); font-size: 0.95rem; opacity: 0.7;">
                            <em>Tap "New Quote" to discover a new affirmation. Share positivity with yourself daily.</em>
                        </p>
                    </div>
                </div>

                <!-- Gratitude -->
                <div class="calm-section">
                    <h2>Gratitude Journal</h2>
                    <p style="text-align: center; color: var(--text-dark); opacity: 0.8; margin-bottom: 2rem;">Reflect on the good things in your life</p>
                    
                    <div style="background: white; padding: 2rem; border-radius: 25px; border: 3px solid var(--mauve); box-shadow: 0 8px 20px rgba(92, 61, 61, 0.1);">
                        <div style="text-align: center; margin-bottom: 1.5rem;">
                            <p style="font-family: 'Playfair Display', serif; font-size: 1.3rem; color: var(--brown); font-style: italic;">What are you grateful for today?</p>
                        </div>
                        
                        <input type="text" class="gratitude-input" id="gratitudeInput" placeholder="I'm grateful for...">
                        <button class="btn" onclick="addGratitude()" style="width: 100%; margin-top: 1rem;">Add Gratitude</button>
                        
                        <div class="gratitude-list" id="gratitudeList" style="margin-top: 2rem;"></div>
                    </div>
                    
                    <div style="margin-top: 2rem; padding: 1.5rem; background: rgba(252, 249, 232, 0.8); border-radius: 20px; border: 2px solid var(--mauve); text-align: center;">
                        <p style="color: var(--text-dark); font-size: 0.95rem; line-height: 1.6;">
                            <strong style="color: var(--brown);">Why Gratitude?</strong><br>
                            <em>Practicing gratitude daily has been shown to improve mood, reduce stress, and enhance overall well-being. Take a moment each day to appreciate the little things.</em>
                        </p>
                    </div>
                </div>

                <!-- Music -->
                <div class="calm-section">
                    <h2>Relaxing Sounds</h2>
                    <div class="music-player">
                        <div class="music-list" id="musicList"></div>
                    </div>
                    <audio id="audioPlayer"></audio>
                </div>
            </div>
        </div>
    </div>

    <!-- CONTACT PAGE -->
    <div id="contactPage" class="page">
        <div class="contact-container">
            <div class="contact-header">
                <h1>Get in Touch</h1>
                <p>We'd love to hear from you.</p>
            </div>

            <div class="contact-content">
                <div class="contact-name">
                    <h2>Tanu Ved Shakya</h2>
                    <p>Founder & Creator of DearDiary</p>
                </div>

                <div class="contact-info">
                    <div class="contact-item">
                        <div class="contact-icon"></div>
                        <div class="contact-details">
                            <h3>Email</h3>
                            <p><a href="mailto:hello@deardiary.com">tanuvedshakya04@gmail.com</a></p>
                        </div>
                    </div>
                    <div class="contact-item">
                        <div class="contact-icon"></div>
                        <div class="contact-details">
                            <h3>Phone</h3>
                            <p><a href="tel:+11234567890">+91 8528577994</a></p>
                        </div>
                    </div>
                    <div class="contact-item">
                        <div class="contact-icon"></div>
                        <div class="contact-details">
                            <h3>LinkedIn</h3>
                            <p><a href="https://www.linkedin.com/in/tanu-ved-shakya-/" target="_blank">linkedin.com/in/tanuvedshakya</a></p>
                        </div>
                    </div>
                </div>

                <div class="social-links">
                    <h3>Connect on Social Media</h3>
                    <div class="social-icons">
                        <a href="https://twitter.com/deardiary" target="_blank" class="social-icon">
                            <svg viewBox="0 0 24 24"><path d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z"/></svg>
                        </a>
                        <a href="https://instagram.com/hqhq_tanu" target="_blank" class="social-icon">
                            <svg viewBox="0 0 24 24"><path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/></svg>
                        </a>
                        <a href="https://facebook.com/deardiary" target="_blank" class="social-icon">
                            <svg viewBox="0 0 24 24"><path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/></svg>
                        </a>
                        <a href="https://linkedin.com/company/deardiary" target="_blank" class="social-icon">
                            <svg viewBox="0 0 24 24"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/></svg>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Diary Reader with Page Turning and book cover-->
    <div id="diaryReader" class="diary-reader">
        <button class="close-reader" onclick="closeDiaryReader()"></button>
        
        <div class="diary-book" id="diaryBook">
            <!-- Book Spine -->
            <div class="book-spine">
                <div class="book-spine-title" id="spineTitle">My Diary</div>
            </div>
            
            <!-- Book Cover -->
            <div class="book-cover" id="bookCover" onclick="openBookCover()">
                <div class="book-cover-front" id="bookCoverFront">
                    <svg class="book-cover-ornament" viewBox="0 0 200 200">
                        <path d="M 100 40 Q 120 60 100 80 Q 80 60 100 40 Z" fill="rgba(255,255,255,0.3)" />
                        <circle cx="100" cy="100" r="50" fill="none" stroke="rgba(255,255,255,0.3)" stroke-width="2"/>
                        <path d="M 100 120 Q 120 140 100 160 Q 80 140 100 120 Z" fill="rgba(255,255,255,0.3)" />
                    </svg>
                    <h2 class="book-cover-title" id="coverTitle">My Diary</h2>
                    <p class="book-cover-info" id="coverInfo">0 entries</p>
                    <p class="book-cover-info" id="coverDates">Date Range</p>
                    <p class="book-cover-cta">Click to open </p>
                </div>
            </div>
            
            <!-- Book Pages -->
            <div class="book-pages-container">
                <div class="book-page left" id="leftPage">
                    <div class="page-content" id="leftPageContent"></div>
                    <div class="page-number left" id="leftPageNumber"></div>
                </div>
                <div class="book-page right" id="rightPage">
                    <div class="page-content" id="rightPageContent"></div>
                    <div class="page-number right" id="rightPageNumber"></div>
                </div>
            </div>
        </div>
        
        <div class="book-controls" id="bookControls" style="display: none;">
            <button class="book-nav-btn" id="prevBtn" onclick="previousPage()"> Previous</button>
            <span style="color: white; font-size: 1.1rem;" id="pageIndicator">Page 1-2</span>
            <button class="book-nav-btn" id="nextBtn" onclick="nextPage()">Next </button>
        </div>
    </div>

    <script>
        // Utility: Check localStorage usage
        function checkStorageUsage() {
            let total = 0;
            for (let key in localStorage) {
                if (localStorage.hasOwnProperty(key)) {
                    total += localStorage[key].length + key.length;
                }
            }
            const usedMB = (total / 1024 / 1024).toFixed(2);
            console.log('LocalStorage used:', usedMB, 'MB');
            return usedMB;
        }
        // STATE
        let selectedDiaryColor = '#f5dcd4';
        let currentPage = 'home';
        let currentUser = null;
        let isLoginMode = true;
        let currentlyPlayingMusic = null;
        let audioPlayer = null;
        let meditationAudio = null;
        let companionShown = false;
        let typingTimer = null;
        let entryToDelete = null;
        let currentFormatting = {
            font: 'dancing',
            size: 18,
            weight: 400,
            color: '#4a2f2f'
        };
        let isDrawingMode = false;
        let drawingCanvas = null;
        let drawingCtx = null;
        let isDrawing = false;
        let lastX = 0;
        let lastY = 0;

        // EMOJI DATA
        const emojiData = {
            smileys: ['','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','',''],
            nature: ['','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','',''],
            objects: ['','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','',''],
            symbols: ['','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','']
        };

        const calmingQuotes = [
            "Take a deep breath. You're allowed to rest before you rise again.",
            "Your feelings are valid. It's okay to not be okay sometimes.",
            "You are stronger than you think, braver than you believe.",
            "Progress, not perfection. Every small step counts.",
            "Be gentle with yourself. You're doing the best you can.",
            "This too shall pass. You've survived 100% of your worst days.",
            "You are worthy of peace, love, and happiness.",
            "It's okay to take things one day at a time.",
            "Your mental health matters. Take care of yourself first.",
            "Healing is not linear. Some days will be harder.",
            "You are enough, exactly as you are right now.",
            "Remember to breathe. You're going to be okay."
        ];

        const companionMessages = {
            home: ["Hello! I'm here to support you.", "Welcome to your safe space."],
            auth: ["Creating your safe space...", "You're taking an important step."],
            diary: ["How was your day?", "Let it all out, I'm listening.", "You're doing great!"],
            calm: ["Let's find peace together.", "Take a deep breath with me."],
            contact: ["Want to reach out? I'm here!"],
            profile: ["Update your info anytime!", "Your profile, your way."]
        };

        const relaxingMusic = [
            { title: "Peaceful Piano", duration: "10:00", url: "https://cdn.pixabay.com/download/audio/2022/03/15/audio_c6e0e49dd7.mp3" },
            { title: "Ocean Waves", duration: "15:00", url: "https://cdn.pixabay.com/download/audio/2022/05/27/audio_1808fbf07a.mp3" },
            { title: "Forest Ambience", duration: "12:00", url: "https://cdn.pixabay.com/download/audio/2022/03/10/audio_4a26cc0e12.mp3" },
            { title: "Gentle Rain", duration: "20:00", url: "https://cdn.pixabay.com/download/audio/2022/05/27/audio_69ce8344dc.mp3" },
            { title: "Meditation Music", duration: "30:00", url: "https://cdn.pixabay.com/download/audio/2022/02/22/audio_d1718ab41b.mp3" }
        ];

        

        // INIT
        window.addEventListener('DOMContentLoaded', () => {
            initializeApp();
            setupEventListeners();
            loadMusicList();
            getNewQuote();
            initializeAudioPlayer();
            // setupDrawingCanvas();
            loadGratitudes();
            setTimeout(() => showCompanionWalkIn(), 1000);
        });

        function initializeApp() {
            const userData = localStorage.getItem('currentUser');
            if (userData) {
                currentUser = JSON.parse(userData);
                console.log('User loaded:', currentUser);
                updateUIForLoggedInUser();
            } else {
                console.log('No user logged in');
                updateUIForLoggedOutUser();
            }
            updateJournalDate();
            
            // Debug check
            console.log('App initialized. Current user:', currentUser);
        }

        function setupEventListeners() {
            document.getElementById('loginForm').addEventListener('submit', handleLogin);
            document.getElementById('signupForm').addEventListener('submit', handleSignup);
            document.getElementById('profileForm').addEventListener('submit', handleProfileUpdate);
            document.getElementById('menuToggle').addEventListener('click', () => {
                document.getElementById('navMenu').classList.toggle('active');
            });
            document.getElementById('imageInput').addEventListener('change', handleImageUpload);
            document.getElementById('profilePicInput').addEventListener('change', handleProfilePicUpload);

            const editor = document.getElementById('diaryEditor');
            editor.addEventListener('input', () => {
                clearTimeout(typingTimer);
                typingTimer = setTimeout(() => nodCompanion(), 500);
            });
            document.addEventListener('keydown', (e) => {
                const reader = document.getElementById('diaryReader');
                if (reader && reader.classList.contains('active')) {
                    if (e.key === 'ArrowRight') {
                        nextPage();
                    } else if (e.key === 'ArrowLeft') {
                        previousPage();
                    } else if (e.key === 'Escape') {
                        closeDiaryReader();
                    }
                }
            });
        }

        // COMPANION
        function showCompanionWalkIn() {
            if (companionShown) return;
            const companion = document.getElementById('companion');
            companion.classList.add('walking-in');
            setTimeout(() => {
                companion.classList.remove('walking-in');
                companionShown = true;
                setTimeout(() => showCompanionMessage(currentPage), 500);
            }, 2000);
        }

        function showCompanionMessage(page) {
            const messages = companionMessages[page] || companionMessages.home;
            const msg = messages[Math.floor(Math.random() * messages.length)];
            document.getElementById('companionMessage').textContent = msg;
            document.getElementById('speechBubble').classList.add('show');
            setTimeout(() => closeSpeechBubble(), 5000);
        }

        function toggleSpeechBubble() {
            const bubble = document.getElementById('speechBubble');
            bubble.classList.contains('show') ? closeSpeechBubble() : showCompanionMessage(currentPage);
        }

        function closeSpeechBubble() {
            document.getElementById('speechBubble').classList.remove('show');
        }

        function nodCompanion() {
            document.getElementById('companion').classList.add('nodding');
            setTimeout(() => document.getElementById('companion').classList.remove('nodding'), 500);
        }

        // NAVIGATION
        function navigateTo(page) {
            document.getElementById('navMenu').classList.remove('active');
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            
            const pageMap = {
                home: 'homePage',
                auth: 'authPage',
                diary: 'diaryPage',
                calm: 'calmPage',
                contact: 'contactPage',
                profile: 'profilePage'
            };
            
            document.getElementById(pageMap[page]).classList.add('active');
            currentPage = page;

            if (page === 'diary') {
                updateJournalDate();
                if (currentUser) loadDiaryEntries();
            }

            if (page === 'profile' && currentUser) loadProfileData();

            setTimeout(() => showCompanionMessage(page), 500);
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function handleAuthNavigation() {
            navigateTo(currentUser ? 'profile' : 'auth');
        }

        function beginDiary() {
            navigateTo('diary');
        }

        // AUTH
        function toggleAuthForm() {
            isLoginMode = !isLoginMode;
            if (isLoginMode) {
                document.getElementById('loginForm').style.display = 'block';
                document.getElementById('signupForm').style.display = 'none';
                document.getElementById('authTitle').textContent = 'Welcome Back';
                document.getElementById('authToggleText').textContent = "Don't have an account? ";
                document.getElementById('authToggleLink').textContent = 'Sign Up';
            } else {
                document.getElementById('loginForm').style.display = 'none';
                document.getElementById('signupForm').style.display = 'block';
                document.getElementById('authTitle').textContent = 'Create Account';
                document.getElementById('authToggleText').textContent = "Already have an account? ";
                document.getElementById('authToggleLink').textContent = 'Login';
            }
            document.getElementById('loginError').style.display = 'none';
            document.getElementById('signupError').style.display = 'none';
        }

        function handleLogin(e) {
            e.preventDefault();
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            const users = JSON.parse(localStorage.getItem('users') || '[]');
            const user = users.find(u => u.email === email && u.password === password);
            
            if (user) {
                currentUser = { 
                    name: user.name, 
                    email: user.email,
                    profilePic: user.profilePic || null,
                    quote: user.quote || '',
                    writingTime: user.writingTime || 'Evening',
                    goal: user.goal || 'Daily reflection'
                };
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
                updateUIForLoggedInUser();
                showToast(`Welcome back, ${user.name}!`, 'success');
                navigateTo('diary');
            } else {
                document.getElementById('loginError').textContent = 'Invalid email or password';
                document.getElementById('loginError').style.display = 'block';
            }
        }

        function handleSignup(e) {
            e.preventDefault();
            const name = document.getElementById('signupName').value;
            const email = document.getElementById('signupEmail').value;
            const password = document.getElementById('signupPassword').value;
            const confirmPassword = document.getElementById('signupConfirmPassword').value;
            const errorEl = document.getElementById('signupError');
            
            if (password !== confirmPassword) {
                errorEl.textContent = 'Passwords do not match';
                errorEl.style.display = 'block';
                return;
            }
            
            const users = JSON.parse(localStorage.getItem('users') || '[]');
            if (users.some(u => u.email === email)) {
                errorEl.textContent = 'Email already registered';
                errorEl.style.display = 'block';
                return;
            }
            
            users.push({ name, email, password });
            localStorage.setItem('users', JSON.stringify(users));
            
            currentUser = { name, email, profilePic: null };
            localStorage.setItem('currentUser', JSON.stringify(currentUser));
            updateUIForLoggedInUser();
            showToast(`Welcome, ${name}!`, 'success');
            navigateTo('diary');
        }

        function logout() {
            currentUser = null;
            localStorage.removeItem('currentUser');
            updateUIForLoggedOutUser();
            showToast('Logged out successfully', 'success');
            navigateTo('home');
        }

        function updateUIForLoggedInUser() {
            const container = document.getElementById('navAuthContainer');
            const initial = currentUser.name.charAt(0).toUpperCase();
            
            if (currentUser.profilePic) {
                container.innerHTML = `<div class="profile-avatar" onclick="navigateTo('profile')"><img src="${currentUser.profilePic}" alt="Profile"></div>`;
            } else {
                container.innerHTML = `<div class="profile-avatar" onclick="navigateTo('profile')">${initial}</div>`;
            }
        }

        function updateUIForLoggedOutUser() {
            document.getElementById('navAuthContainer').innerHTML = `<a onclick="navigateTo('auth')" class="btn">Login/Sign Up</a>`;
        }

        // PROFILE
        function loadProfileData() {
            if (!currentUser) return;
            document.getElementById('profileName').value = currentUser.name;
            document.getElementById('profileEmail').value = currentUser.email;
            document.getElementById('profileQuote').value = currentUser.quote || '';
            document.getElementById('profileWritingTime').value = currentUser.writingTime || 'Evening';
            document.getElementById('profileGoal').value = currentUser.goal || 'Daily reflection';
            document.getElementById('profileGreeting').textContent = `Hello, ${currentUser.name}!`;
            
            const picDisplay = document.getElementById('profilePicDisplay');
            if (currentUser.profilePic) {
                picDisplay.innerHTML = `<img src="${currentUser.profilePic}" alt="Profile">`;
            } else {
                picDisplay.textContent = currentUser.name.charAt(0).toUpperCase();
            }
        }

        function handleProfileUpdate(e) {
            e.preventDefault();
            const newName = document.getElementById('profileName').value;
            const newPassword = document.getElementById('profileNewPassword').value;
            const quote = document.getElementById('profileQuote').value;
            const writingTime = document.getElementById('profileWritingTime').value;
            const goal = document.getElementById('profileGoal').value;
            
            const users = JSON.parse(localStorage.getItem('users') || '[]');
            const userIndex = users.findIndex(u => u.email === currentUser.email);
            
            if (userIndex !== -1) {
                users[userIndex].name = newName;
                users[userIndex].quote = quote;
                users[userIndex].writingTime = writingTime;
                users[userIndex].goal = goal;
                if (newPassword) users[userIndex].password = newPassword;
                if (currentUser.profilePic) users[userIndex].profilePic = currentUser.profilePic;
                
                localStorage.setItem('users', JSON.stringify(users));
                
                currentUser.name = newName;
                currentUser.quote = quote;
                currentUser.writingTime = writingTime;
                currentUser.goal = goal;
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
                
                updateUIForLoggedInUser();
                showToast('Profile updated!', 'success');
                loadProfileData();
            }
        }

        function handleProfilePicUpload(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    currentUser.profilePic = e.target.result;
                    localStorage.setItem('currentUser', JSON.stringify(currentUser));
                    
                    const users = JSON.parse(localStorage.getItem('users') || '[]');
                    const userIndex = users.findIndex(u => u.email === currentUser.email);
                    if (userIndex !== -1) {
                        users[userIndex].profilePic = e.target.result;
                        localStorage.setItem('users', JSON.stringify(users));
                    }
                    
                    loadProfileData();
                    updateUIForLoggedInUser();
                    showToast('Profile picture updated!', 'success');
                };
                reader.readAsDataURL(file);
            }
        }

        // DIARY
        function updateJournalDate() {
            const now = new Date();
            const dateStr = now.toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
            document.getElementById('journalDate').textContent = dateStr;
            
            const greetings = ["What's in your heart today?", "Welcome to your safe space", "Your thoughts matter"];
            document.getElementById('journalGreeting').textContent = greetings[Math.floor(Math.random() * greetings.length)];
        }

        function switchDiaryTab(tab) {
            const writeTab = document.getElementById('writeTab');
            const viewTab = document.getElementById('viewTab');
            const buttons = document.querySelectorAll('.tab-btn');
            
            buttons.forEach(btn => btn.classList.remove('active'));
            
            if (tab === 'write') {
                writeTab.style.display = 'block';
                viewTab.style.display = 'none';
                buttons[0].classList.add('active');
                updateJournalDate();
            } else {
                writeTab.style.display = 'none';
                viewTab.style.display = 'block';
                buttons[1].classList.add('active');
                loadDiaryEntries();
            }
        }

        // FORMATTING
        function changeFont() {
            const select = document.getElementById('fontSelect');
            const editor = document.getElementById('diaryEditor');
            const fonts = {
                dancing: "'Dancing Script', cursive",
                caveat: "'Caveat', cursive",
                indie: "'Indie Flower', cursive",
                shadows: "'Shadows Into Light', cursive"
            };
            editor.style.fontFamily = fonts[select.value];
            currentFormatting.font = select.value;
        }

        function changeFontSize() {
            const slider = document.getElementById('sizeSlider');
            const size = slider.value;
            document.getElementById('sizeDisplay').textContent = size + 'px';
            currentFormatting.size = parseInt(size);
            
            // Apply to selection
            const editor = document.getElementById('diaryEditor');
            editor.focus();
            document.execCommand('fontSize', false, '7'); // Use command first
            
            // Then override with custom size
            const fontElements = editor.querySelectorAll('font[size="7"]');
            fontElements.forEach(el => {
                el.removeAttribute('size');
                el.style.fontSize = size + 'px';
            });
        }

        function changeFontWeight() {
            const slider = document.getElementById('weightSlider');
            const editor = document.getElementById('diaryEditor');
            const weight = slider.value;
            editor.style.fontWeight = weight;
            currentFormatting.weight = parseInt(weight);
        }

        function changeTextColor() {
            const color = document.getElementById('colorInput').value;
            document.execCommand('foreColor', false, color);
            currentFormatting.color = color;
        }

        function toggleFormat(type) {
            const editor = document.getElementById('diaryEditor');
            editor.focus();
            
            const commands = {
                bold: 'bold',
                italic: 'italic',
                underline: 'underline'
            };
            
            document.execCommand(commands[type], false, null);
            
            // Toggle button visual state
            const btn = document.getElementById(`${type}Btn`);
            const isActive = document.queryCommandState(commands[type]);
            
            if (isActive) {
                btn.classList.add('active');
            } else {
                btn.classList.remove('active');
            }
        }

        function toggleHighlight() {
            const editor = document.getElementById('diaryEditor');
            editor.focus();
            
            const btn = document.getElementById('highlightBtn');
            const selection = window.getSelection();
            
            if (!selection.rangeCount) return;
            
            if (btn.classList.contains('active')) {
                // Remove highlight
                document.execCommand('removeFormat', false, null);
                btn.classList.remove('active');
            } else {
                // Add highlight
                const range = selection.getRangeAt(0);
                const span = document.createElement('span');
                span.style.backgroundColor = '#ffeb3b';
                span.style.padding = '2px 4px';
                span.style.borderRadius = '3px';
                
                try {
                    range.surroundContents(span);
                    btn.classList.add('active');
                } catch (e) {
                    // Fallback to execCommand
                    document.execCommand('hiliteColor', false, '#ffeb3b');
                    btn.classList.add('active');
                }
            }
        }

        // EMOJI PICKER
        function toggleEmojiPicker() {
            const picker = document.getElementById('emojiPicker');
            picker.classList.toggle('show');
            if (picker.classList.contains('show')) showEmojiCategory('smileys');
        }

        function showEmojiCategory(category) {
            const grid = document.getElementById('emojiGrid');
            const emojis = emojiData[category] || emojiData.smileys;
            grid.innerHTML = emojis.map(e => `<div class="emoji-item" onclick="insertEmoji('${e}')">${e}</div>`).join('');
        }

        function insertEmoji(emoji) {
            const editor = document.getElementById('diaryEditor');
            
            // Ensure editor has focus
            editor.focus();
            
            // Small delay to ensure focus is set
            setTimeout(() => {
                const selection = window.getSelection();
                
                // If no selection, create one at the end
                if (selection.rangeCount === 0) {
                    const range = document.createRange();
                    range.selectNodeContents(editor);
                    range.collapse(false);
                    selection.removeAllRanges();
                    selection.addRange(range);
                }
                
                const range = selection.getRangeAt(0);
                
                // Delete any selected content
                range.deleteContents();
                
                // Create text node with emoji
                const emojiNode = document.createTextNode(emoji);
                range.insertNode(emojiNode);
                
                // Move cursor after the emoji
                range.setStartAfter(emojiNode);
                range.setEndAfter(emojiNode);
                range.collapse(false);
                
                // Update selection
                selection.removeAllRanges();
                selection.addRange(range);
                
                // Close picker
                document.getElementById('emojiPicker').classList.remove('show');
                
                // Keep focus on editor
                editor.focus();
            }, 10);
        }

        // IMAGES
        function handleImageUpload(e) {
            const files = e.target.files;
            const editor = document.getElementById('diaryEditor');
            
            Array.from(files).forEach(file => {
                if (file.type.startsWith('image/')) {
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        editor.focus();
                        
                        // Create image element
                        const img = document.createElement('img');
                        img.src = event.target.result;
                        img.style.maxWidth = '250px';
                        img.style.borderRadius = '15px';
                        img.style.margin = '0.5rem';
                        img.style.boxShadow = '0 4px 15px rgba(0,0,0,0.15)';
                        img.draggable = true;
                        
                        // Insert at cursor position
                        const selection = window.getSelection();
                        if (selection.rangeCount > 0) {
                            const range = selection.getRangeAt(0);
                            range.insertNode(img);
                            
                            // Add space after image
                            const space = document.createTextNode(' ');
                            range.insertNode(space);
                            
                            // Move cursor after image
                            range.setStartAfter(img);
                            range.setEndAfter(img);
                            selection.removeAllRanges();
                            selection.addRange(range);
                        }
                    };
                    reader.readAsDataURL(file);
                }
            });
            
            // Reset input
            e.target.value = '';
        }

        // SAVE/LOAD ENTRIES
        function saveDiaryEntry() {
            console.log('=== SAVE ENTRY STARTED ===');
            
            const editor = document.getElementById('diaryEditor');
            
            if (!editor) {
                console.error('ERROR: Editor element not found');
                showToast('Error: Editor not found', 'error');
                return;
            }
            
            console.log('Editor found:', editor);
            
            const content = editor.innerHTML.trim();
            
            console.log('Content length:', content.length);
            console.log('Content preview:', content.substring(0, 100));
            
            if (!content || content === '<br>' || content === '') {
                console.log('ERROR: Content is empty');
                showToast('Please write something before saving', 'error');
                return;
            }
            
            if (!currentUser) {
                console.log('ERROR: No current user');
                const modal = document.getElementById('loginPromptModal');
                if (modal) {
                    modal.classList.add('show');
                }
                return;
            }
            
            console.log('User email:', currentUser.email);
            
            const storageKey = `diary_${currentUser.email}`;
            console.log('Storage key:', storageKey);
            
            const entries = JSON.parse(localStorage.getItem(storageKey) || '[]');
            console.log('Existing entries count:', entries.length);
            
            // Check if editing
            if (window.editingEntryId) {
                console.log('Editing entry ID:', window.editingEntryId);
                const index = entries.findIndex(e => e.id === window.editingEntryId);
                if (index !== -1) {
                    entries[index].content = content;
                    entries[index].dateFormatted += ' (Edited)';
                    localStorage.setItem(storageKey, JSON.stringify(entries));
                    console.log('Entry updated at index:', index);
                    editor.innerHTML = '';
                    window.editingEntryId = null;
                    showToast('Entry updated!', 'success');
                    return;
                }
            }
            
            // Create new entry
            const newEntry = {
                id: Date.now(),
                content: content,
                date: new Date().toISOString(),
                dateFormatted: new Date().toLocaleString('en-US', {
                    weekday: 'long',
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                })
            };
            
            console.log('New entry created:', newEntry);
            
            entries.unshift(newEntry);
            
            try {
                localStorage.setItem(storageKey, JSON.stringify(entries));
                console.log('Successfully saved to localStorage');
                console.log('New total entries:', entries.length);
            } catch (e) {
                console.error('ERROR saving to localStorage:', e);
                showToast('Error saving entry', 'error');
                return;
            }
            
            // Verify it was saved
            const verify = JSON.parse(localStorage.getItem(storageKey) || '[]');
            console.log('Verification - entries in storage:', verify.length);
            
            editor.innerHTML = '';
            
            showToast('Entry saved successfully!', 'success');
            nodCompanion();
            showCompanionMessage('diary');
            
            console.log('=== SAVE ENTRY COMPLETED ===');
        }
        function loadDiaryEntries() {
            const viewTab = document.getElementById('viewTab');
            
            if (!currentUser) {
                viewTab.innerHTML = `
                    <div class="empty-state">
                        <h3>Login to View Entries</h3>
                        <p>Sign in to save and view your diary entries.</p>
                        <button class="btn" onclick="navigateTo('auth')">Login</button>
                    </div>
                `;
                return;
            }
            
            const entries = JSON.parse(localStorage.getItem(`diary_${currentUser.email}`) || '[]');

            const usage = checkStorageUsage();
            
            // Build HTML
            viewTab.innerHTML = `
                <!-- Create Diary Section -->
                <div style="margin-bottom: 3rem;">
                    <div class="create-diary-section">
                        <h3>Create a New Diary Book</h3>
                        <p style="text-align: center; color: var(--text-dark); opacity: 0.8; margin-bottom: 1.5rem;">Compile your entries from a specific time period into a beautiful diary book</p>
                        
                        <div class="diary-form">
                            <input type="text" id="diaryName" placeholder="Diary Name (e.g., 'Summer Memories 2024')" style="font-size: 1.05rem;">
                            
                            <div class="diary-form-row">
                                <div>
                                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 500; color: var(--text-dark);">Start Date</label>
                                    <input type="date" id="diaryStartDate">
                                </div>
                                <div>
                                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 500; color: var(--text-dark);">End Date</label>
                                    <input type="date" id="diaryEndDate">
                                </div>
                            </div>
                            
                            <div>
                                <label style="display: block; margin-bottom: 0.8rem; font-weight: 500; color: var(--text-dark);">Choose Diary Color:</label>
                                <div class="color-picker-group" id="colorPickerGroup">
                                    <div class="color-option selected" data-color="#f5dcd4" style="background: #f5dcd4;" onclick="selectDiaryColor('#f5dcd4', this)"></div>
                                    <div class="color-option" data-color="#ffd4e5" style="background: #ffd4e5;" onclick="selectDiaryColor('#ffd4e5', this)"></div>
                                    <div class="color-option" data-color="#e4d4f4" style="background: #e4d4f4;" onclick="selectDiaryColor('#e4d4f4', this)"></div>
                                    <div class="color-option" data-color="#d4e4f4" style="background: #d4e4f4;" onclick="selectDiaryColor('#d4e4f4', this)"></div>
                                    <div class="color-option" data-color="#d4f4e4" style="background: #d4f4e4;" onclick="selectDiaryColor('#d4f4e4', this)"></div>
                                    <div class="color-option" data-color="#f4f4d4" style="background: #f4f4d4;" onclick="selectDiaryColor('#f4f4d4', this)"></div>
                                    <div class="color-option" data-color="#fcf9e8" style="background: #fcf9e8;" onclick="selectDiaryColor('#fcf9e8', this)"></div>
                                    <div class="color-option" data-color="#e8d5c4" style="background: #e8d5c4;" onclick="selectDiaryColor('#e8d5c4', this)"></div>
                                    <div class="color-option" data-color="#d4c0b8" style="background: #d4c0b8;" onclick="selectDiaryColor('#d4c0b8', this)"></div>
                                    <div class="color-option" data-color="#f4d4d4" style="background: #f4d4d4;" onclick="selectDiaryColor('#f4d4d4', this)"></div>
                                    <div class="color-option" data-color="#d4d4f4" style="background: #d4d4f4;" onclick="selectDiaryColor('#d4d4f4', this)"></div>
                                    <div class="color-option" data-color="#e8e4d8" style="background: #e8e4d8;" onclick="selectDiaryColor('#e8e4d8', this)"></div>
                                </div>
                            </div>
                            
                            <button class="btn" onclick="createDiary()" style="margin-top: 1.5rem; width: 100%; font-size: 1.1rem;">Create Diary Book</button>
                        </div>
                    </div>
                </div>

                <!-- My Diary Books -->
                <div style="margin-bottom: 3rem;">
                    <h3 style="font-family: 'Playfair Display', serif; font-size: 2.2rem; color: var(--brown); margin-bottom: 2rem; text-align: center;"> My Diary Books</h3>
                    <div id="diariesPanel" class="diaries-panel"></div>
                </div>

                <!-- All Entries -->
                <div>
                    <h3 style="font-family: 'Playfair Display', serif; font-size: 2.2rem; color: var(--brown); margin-bottom: 2rem; text-align: center;"> All Entries</h3>
                    <div id="allEntriesList" class="entries-container">
                        ${entries.length === 0 ? `
                            <div class="empty-state">
                                <h3>No entries yet</h3>
                                <p>Start writing your first entry!</p>
                            </div>
                        ` : entries.map(entry => `
                            <div class="entry-card">
                                <div class="entry-card-header">
                                    <div class="entry-date">${entry.dateFormatted}</div>
                                    <div class="entry-actions">
                                        <button onclick="editEntry(${entry.id})">Edit</button>
                                        <button onclick="showDeleteModal(${entry.id})">Delete</button>
                                    </div>
                                </div>
                                <div class="entry-content">${entry.content}</div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
            
            // Load diaries after DOM is ready
            setTimeout(() => {
                loadDiaries();
                // Reset color selection to default
                selectedDiaryColor = '#f5dcd4';
            }, 100);
        }


        function editEntry(entryId) {
            const entries = JSON.parse(localStorage.getItem(`diary_${currentUser.email}`) || '[]');
            const entry = entries.find(e => e.id === entryId);
            if (!entry) return;
            
            switchDiaryTab('write');
            document.getElementById('diaryEditor').innerHTML = entry.content;
            window.editingEntryId = entryId;
            showToast('Editing entry', 'info');
        }

        function showDeleteModal(id) {
            entryToDelete = id;
            document.getElementById('deleteModal').classList.add('show');
        }

        function cancelDelete() {
            entryToDelete = null;
            document.getElementById('deleteModal').classList.remove('show');
        }

        function confirmDelete() {
            if (!entryToDelete) return;
            const entries = JSON.parse(localStorage.getItem(`diary_${currentUser.email}`) || '[]');
            const filtered = entries.filter(e => e.id !== entryToDelete);
            localStorage.setItem(`diary_${currentUser.email}`, JSON.stringify(filtered));
            loadDiaryEntries();
            showToast('Entry deleted', 'success');
            cancelDelete();
        }

        function closeLoginPrompt() {
            document.getElementById('loginPromptModal').classList.remove('show');
        }

        function goToAuth() {
            closeLoginPrompt();
            navigateTo('auth');
        }

        // MEDITATION
        let meditationInterval = null;
        let meditationSeconds = 300;
        let meditationRunning = false;
        let meditationPaused = false;
        let meditationFullscreen = false;
        let originalMeditationSeconds = 300;

        function setTimer(minutes) {
            if (meditationRunning) {
                showToast('Stop current meditation first', 'error');
                return;
            }
            meditationSeconds = minutes * 60;
            originalMeditationSeconds = meditationSeconds;
            updateTimerDisplay();
            showToast(`Timer set to ${minutes} minutes`, 'success');
        }

        function setCustomTimer() {
            const input = document.getElementById('customMinutes');
            const minutes = parseInt(input.value);
            
            if (!minutes || minutes < 1 || minutes > 60) {
                showToast('Please enter 1-60 minutes', 'error');
                return;
            }
            
            if (meditationRunning) {
                showToast('Stop current meditation first', 'error');
                return;
            }
            
            meditationSeconds = minutes * 60;
            originalMeditationSeconds = meditationSeconds;
            updateTimerDisplay();
            showToast(`Timer set to ${minutes} minutes`, 'success');
            input.value = '';
        }

        function updateTimerDisplay() {
            const mins = Math.floor(meditationSeconds / 60);
            const secs = meditationSeconds % 60;
            const time = `${String(mins).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;
            
            const timerDisplay = document.getElementById('timerDisplay');
            if (timerDisplay) timerDisplay.textContent = time;
            
            const fullscreenTimer = document.getElementById('fullscreenTimer');
            if (fullscreenTimer) fullscreenTimer.textContent = time;
        }

        function startMeditation() {
            console.log('startMeditation called');
            console.log('Current state - Running:', meditationRunning, 'Paused:', meditationPaused);
            
            // If running, pause it
            if (meditationRunning && !meditationPaused) {
                pauseTimer();
                return;
            }
            
            // If paused, resume
            if (meditationPaused) {
                resumeTimer();
                return;
            }
            
            // Starting fresh
            const useFullscreen = confirm('Would you like fullscreen meditation mode with calming music?\n\nOK = Fullscreen with music\nCancel = Normal timer');
            
            if (useFullscreen) {
                enterFullscreenMode();
            }
            
            actuallyStartTimer();
        }

        function enterFullscreenMode() {
            meditationFullscreen = true;
            const fullscreenEl = document.getElementById('meditationFullscreen');
            if (fullscreenEl) {
                fullscreenEl.classList.add('active');
                console.log('Fullscreen activated');
            } else {
                console.error('Fullscreen element not found');
            }
            
            // Start meditation music
            if (audioPlayer) {
                audioPlayer.src = relaxingMusic[4].url;
                audioPlayer.loop = true;
                audioPlayer.volume = 0.5;
                audioPlayer.play().catch(err => {
                    console.log('Audio play error:', err);
                    showToast('Click to enable audio', 'info');
                });
            }
        }

        function actuallyStartTimer() {
            console.log('actuallyStartTimer called with seconds:', meditationSeconds);
            
            meditationRunning = true;
            meditationPaused = false;
            
            const btn = document.getElementById('timerBtn');
            if (btn) {
                btn.textContent = 'Pause';
                console.log('Button text changed to Pause');
            }
            
            meditationInterval = setInterval(() => {
                meditationSeconds--;
                updateTimerDisplay();
                
                // Update breathing text
                const cycle = meditationSeconds % 8;
                const breatheText = cycle < 4 ? 'Breathe In...' : 'Breathe Out...';
                
                const breatheEl = document.getElementById('breatheText');
                if (breatheEl) breatheEl.textContent = breatheText;
                
                const fullscreenBreathe = document.getElementById('fullscreenBreathe');
                if (fullscreenBreathe) fullscreenBreathe.textContent = breatheText;
                
                // Check completion
                if (meditationSeconds <= 0) {
                    completeMeditation();
                }
            }, 1000);
            
            console.log('Interval started');
        }

        function pauseTimer() {
            console.log('Pausing timer');
            meditationRunning = false;
            meditationPaused = true;
            clearInterval(meditationInterval);
            
            const btn = document.getElementById('timerBtn');
            if (btn) btn.textContent = 'Resume';
            
            const breatheEl = document.getElementById('breatheText');
            if (breatheEl) breatheEl.textContent = 'Paused';
            
            const fullscreenBreathe = document.getElementById('fullscreenBreathe');
            if (fullscreenBreathe) fullscreenBreathe.textContent = 'Paused';
            
            showToast('Paused', 'info');
        }

        function resumeTimer() {
            console.log('Resuming timer');
            actuallyStartTimer();
            showToast('Resumed', 'success');
        }

        function stopTimer() {
            console.log('Stopping timer');
            meditationRunning = false;
            meditationPaused = false;
            clearInterval(meditationInterval);
            
            const btn = document.getElementById('timerBtn');
            if (btn) btn.textContent = 'Start Meditation';
            
            const breatheEl = document.getElementById('breatheText');
            if (breatheEl) breatheEl.textContent = 'Breathe';
            
            // Exit fullscreen
            if (meditationFullscreen) {
                const fullscreenEl = document.getElementById('meditationFullscreen');
                if (fullscreenEl) fullscreenEl.classList.remove('active');
                meditationFullscreen = false;
            }
            
            // Stop audio
            if (audioPlayer) {
                audioPlayer.pause();
                audioPlayer.loop = false;
                audioPlayer.currentTime = 0;
            }
        }

        function resetTimer() {
            console.log('Resetting timer');
            stopTimer();
            meditationSeconds = originalMeditationSeconds;
            updateTimerDisplay();
            showToast('Timer reset', 'info');
        }

        function completeMeditation() {
            console.log('Meditation complete');
            clearInterval(meditationInterval);
            meditationRunning = false;
            meditationPaused = false;
            
            if (audioPlayer) {
                audioPlayer.pause();
                audioPlayer.loop = false;
            }
            
            if (meditationFullscreen) {
                document.getElementById('meditationFullscreen').classList.remove('active');
                meditationFullscreen = false;
            }
            
            const btn = document.getElementById('timerBtn');
            if (btn) btn.textContent = 'Start Meditation';
            
            showToast('Meditation complete! Well done.', 'success');
            
            meditationSeconds = originalMeditationSeconds;
            updateTimerDisplay();
        }

        function exitMeditation() {
            document.getElementById('meditationFullscreen').classList.remove('active');
            meditationFullscreen = false;
            showToast('Exited fullscreen. Timer still running.', 'info');
        }

        function pauseTimerFromFullscreen() {
            pauseTimer();
        }

        function stopTimerFromFullscreen() {
            if (confirm('Stop meditation and exit?')) {
                stopTimer();
            }
        }

        // GRATITUDE
        function addGratitude() {
            const input = document.getElementById('gratitudeInput');
            const text = input.value.trim();
            
            if (!text) {
                showToast('Please write something', 'error');
                return;
            }
            
            const gratitudes = JSON.parse(localStorage.getItem('gratitudes') || '[]');
            gratitudes.unshift({
                id: Date.now(),
                text: text,
                date: new Date().toLocaleDateString()
            });
            
            localStorage.setItem('gratitudes', JSON.stringify(gratitudes));
            input.value = '';
            loadGratitudes();
            showToast('Gratitude added!', 'success');
        }

        function loadGratitudes() {
            const gratitudes = JSON.parse(localStorage.getItem('gratitudes') || '[]');
            const list = document.getElementById('gratitudeList');
            
            if (gratitudes.length === 0) {
                list.innerHTML = '<p style="text-align: center; opacity: 0.6; margin-top: 1rem;">Start adding things you\'re grateful for</p>';
                return;
            }
            
            list.innerHTML = gratitudes.slice(0, 5).map(item => `
                <div class="gratitude-item">
                    <strong>${escapeHtml(item.text)}</strong>
                    <div style="font-size: 0.85rem; opacity: 0.7; margin-top: 0.3rem;">${item.date}</div>
                </div>
            `).join('');
        }

        // CALM
        function getNewQuote() {
            const quote = calmingQuotes[Math.floor(Math.random() * calmingQuotes.length)];
            const el = document.getElementById('calmQuote');
            el.style.opacity = '0';
            setTimeout(() => {
                el.textContent = `"${quote}"`;
                el.style.opacity = '1';
            }, 300);
        }

        function initializeAudioPlayer() {
            audioPlayer = document.getElementById('audioPlayer');
            audioPlayer.addEventListener('ended', () => {
                if (currentlyPlayingMusic !== null) {
                    document.getElementById(`music-${currentlyPlayingMusic}`).classList.remove('playing');
                    document.getElementById(`play-icon-${currentlyPlayingMusic}`).textContent = '';
                    currentlyPlayingMusic = null;
                }
            });
        }

        function loadMusicList() {
            document.getElementById('musicList').innerHTML = relaxingMusic.map((m, i) => `
                <div class="music-item" id="music-${i}">
                    <div class="music-info">
                        <button class="play-btn" onclick="toggleMusic(${i})">
                            <span id="play-icon-${i}"></span>
                        </button>
                        <div class="music-title">${m.title}</div>
                    </div>
                    <div>${m.duration}</div>
                </div>
            `).join('');
        }

        function toggleMusic(index) {
            const item = document.getElementById(`music-${index}`);
            const icon = document.getElementById(`play-icon-${index}`);
            
            if (currentlyPlayingMusic !== null && currentlyPlayingMusic !== index) {
                document.getElementById(`music-${currentlyPlayingMusic}`).classList.remove('playing');
                document.getElementById(`play-icon-${currentlyPlayingMusic}`).textContent = '';
                audioPlayer.pause();
            }
            
            if (currentlyPlayingMusic === index) {
                item.classList.remove('playing');
                icon.textContent = '';
                currentlyPlayingMusic = null;
                audioPlayer.pause();
            } else {
                item.classList.add('playing');
                icon.textContent = '';
                currentlyPlayingMusic = index;
                audioPlayer.src = relaxingMusic[index].url;
                audioPlayer.play();
                showToast(`Playing: ${relaxingMusic[index].title}`, 'success');
            }
        }

        // UTILS
        function showToast(message, type = 'info') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = `toast ${type} show`;
            setTimeout(() => toast.classList.remove('show'), 3500);
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        // DIARY BOOK CREATION
        function selectDiaryColor(color, element) {
            console.log('Color selected:', color);
            selectedDiaryColor = color;
            
            // Remove selected class from all
            const allOptions = document.querySelectorAll('.color-option');
            allOptions.forEach(opt => opt.classList.remove('selected'));
            
            // Add selected class to clicked element
            if (element) {
                element.classList.add('selected');
            }
        }

        


        function createDiary() {
            console.log('=== CREATE DIARY STARTED ===');
            
            if (!currentUser) {
                showToast('Please login to create diaries', 'error');
                return;
            }
            
            const nameInput = document.getElementById('diaryName');
            const startInput = document.getElementById('diaryStartDate');
            const endInput = document.getElementById('diaryEndDate');
            
            if (!nameInput || !startInput || !endInput) {
                showToast('Error: Form not loaded. Try refreshing.', 'error');
                return;
            }
            
            const name = nameInput.value.trim();
            const startDate = startInput.value;
            const endDate = endInput.value;
            
            if (!name) {
                showToast('Please enter a diary name', 'error');
                return;
            }
            
            if (!startDate || !endDate) {
                showToast('Please select both dates', 'error');
                return;
            }
            
            const start = new Date(startDate);
            const end = new Date(endDate);
            
            if (start > end) {
                showToast('Start date must be before end date', 'error');
                return;
            }
            
            // Get all entries
            const storageKey = `diary_${currentUser.email}`;
            const allEntries = JSON.parse(localStorage.getItem(storageKey) || '[]');
            
            // Filter entries and store ONLY IDs (not full content)
            const filteredEntryIds = allEntries
                .filter(entry => {
                    const entryDate = new Date(entry.date);
                    const endOfDay = new Date(endDate);
                    endOfDay.setHours(23, 59, 59, 999);
                    return entryDate >= start && entryDate <= endOfDay;
                })
                .map(entry => entry.id); // Store only IDs!
            
            console.log('Filtered entry IDs:', filteredEntryIds.length);
            
            if (filteredEntryIds.length === 0) {
                showToast('No entries found in this date range', 'error');
                return;
            }
            
            // Get existing diaries
            const diariesKey = `diaries_${currentUser.email}`;
            const diaries = JSON.parse(localStorage.getItem(diariesKey) || '[]');
            
            // Create new diary with ONLY entry IDs
            const newDiary = {
                id: Date.now(),
                name: name,
                color: selectedDiaryColor,
                startDate: startDate,
                endDate: endDate,
                entryIds: filteredEntryIds, // Store IDs only!
                entryCount: filteredEntryIds.length,
                createdAt: new Date().toISOString()
            };
            
            diaries.unshift(newDiary);
            
            try {
                localStorage.setItem(diariesKey, JSON.stringify(diaries));
                console.log('Diary saved successfully');
            } catch (e) {
                console.error('Storage error:', e);
                showToast('Storage full. Try deleting old entries.', 'error');
                return;
            }
            
            // Clear form
            nameInput.value = '';
            startInput.value = '';
            endInput.value = '';
            selectedDiaryColor = '#f5dcd4';
            
            document.querySelectorAll('.color-option').forEach(opt => opt.classList.remove('selected'));
            document.querySelector('.color-option[data-color="#f5dcd4"]')?.classList.add('selected');
            
            loadDiaries();
            showToast(`"${name}" created with ${filteredEntryIds.length} entries!`, 'success');

            const usage = checkStorageUsage();
            console.log('Storage usage after save:', usage, 'MB');
            
            if (parseFloat(usage) > 4) {
                showToast('Storage getting full. Consider deleting old entries.', 'info');
            }
        }



        function loadDiaries() {
            if (!currentUser) return;
            
            const storageKey = `diaries_${currentUser.email}`;
            const diaries = JSON.parse(localStorage.getItem(storageKey) || '[]');
            
            console.log('Loading', diaries.length, 'diaries');
            
            const panel = document.getElementById('diariesPanel');
            if (!panel) return;
            
            if (diaries.length === 0) {
                panel.innerHTML = `
                    <div style="grid-column: 1 / -1; text-align: center; padding: 3rem; background: white; border-radius: 25px; border: 2px dashed var(--mauve);">
                        <p style="font-family: 'Playfair Display', serif; font-size: 1.3rem; color: var(--brown); margin-bottom: 0.5rem;">No diary books yet</p>
                        <p style="color: var(--text-dark); opacity: 0.7;">Create your first diary book above!</p>
                    </div>
                `;
                return;
            }
            
            panel.innerHTML = diaries.map(diary => `
                <div class="diary-book-card" style="border-color: ${diary.color};" onclick="openDiaryReader(${diary.id})">
                    <div class="diary-book-spine" style="background: ${diary.color};"></div>
                    <h4>${escapeHtml(diary.name)}</h4>
                    <p style="font-weight: 600; color: var(--brown);">${diary.entryCount || diary.entryIds?.length || 0} entries</p>
                    <p style="font-size: 0.9rem; opacity: 0.7;">${new Date(diary.startDate).toLocaleDateString('en-US', {month: 'short', day: 'numeric', year: 'numeric'})} - ${new Date(diary.endDate).toLocaleDateString('en-US', {month: 'short', day: 'numeric', year: 'numeric'})}</p>
                    <div class="diary-actions-mini" onclick="event.stopPropagation()">
                        <button onclick="deleteDiary(${diary.id})"> Delete</button>
                    </div>
                </div>
            `).join('');
        }


        function deleteDiary(diaryId) {
            console.log('Deleting diary:', diaryId);
            
            if (!confirm('Delete this diary book? This will not delete your original entries.')) {
                return;
            }
            
            const diariesKey = `diaries_${currentUser.email}`;
            const diaries = JSON.parse(localStorage.getItem(diariesKey) || '[]');
            
            console.log('Diaries before delete:', diaries.length);
            
            const filtered = diaries.filter(d => d.id !== diaryId);
            
            console.log('Diaries after delete:', filtered.length);
            
            try {
                localStorage.setItem(diariesKey, JSON.stringify(filtered));
                console.log('Deleted successfully');
            } catch (e) {
                console.error('Error deleting:', e);
                showToast('Error deleting diary', 'error');
                return;
            }
            
            loadDiaries();
            showToast('Diary book deleted', 'success');
        }


        // DIARY READER - COMPLETE WITH BOOK COVER
        let currentDiaryPages = [];
        let currentPageIndex = 0;
        let currentDiaryColor = '#f5dcd4';

        function openDiaryReader(diaryId) {
            console.log('Opening diary:', diaryId);
            
            const diariesKey = `diaries_${currentUser.email}`;
            const diaries = JSON.parse(localStorage.getItem(diariesKey) || '[]');
            const diary = diaries.find(d => d.id === diaryId);
            
            if (!diary) {
                console.error('Diary not found');
                showToast('Diary not found', 'error');
                return;
            }
            
            // Get actual entries from storage using IDs
            const entriesKey = `diary_${currentUser.email}`;
            const allEntries = JSON.parse(localStorage.getItem(entriesKey) || '[]');
            
            // Load full entries by matching IDs
            currentDiaryPages = allEntries.filter(entry => 
                diary.entryIds?.includes(entry.id)
            );
            
            console.log('Loaded', currentDiaryPages.length, 'entries for diary');
            
            if (currentDiaryPages.length === 0) {
                showToast('No entries found in this diary', 'error');
                return;
            }
            
            currentPageIndex = 0;
            currentDiaryColor = diary.color;
            
            // Set up book cover
            const coverFront = document.getElementById('bookCoverFront');
            if (coverFront) {
                coverFront.style.background = `linear-gradient(135deg, ${diary.color} 0%, ${adjustColorBrightness(diary.color, -20)} 100%)`;
            }
            
            document.getElementById('coverTitle').textContent = diary.name;
            document.getElementById('coverInfo').textContent = `${currentDiaryPages.length} entries`;
            document.getElementById('coverDates').textContent = `${new Date(diary.startDate).toLocaleDateString()} - ${new Date(diary.endDate).toLocaleDateString()}`;
            
            // Set spine
            const spine = document.querySelector('.book-spine');
            if (spine) {
                spine.style.background = `linear-gradient(90deg, ${adjustColorBrightness(diary.color, -60)} 0%, ${adjustColorBrightness(diary.color, -40)} 50%, ${adjustColorBrightness(diary.color, -60)} 100%)`;
            }
            
            document.getElementById('spineTitle').textContent = diary.name;
            
            // Reset cover
            const bookCover = document.getElementById('bookCover');
            if (bookCover) {
                bookCover.classList.remove('opened');
            }
            
            document.getElementById('bookControls').style.display = 'none';
            
            // Show reader
            document.getElementById('diaryReader').classList.add('active');
        }

        function openBookCover() {
            console.log('Opening book cover');
            
            // Animate cover opening
            document.getElementById('bookCover').classList.add('opened');
            
            // Show controls after animation
            setTimeout(() => {
                document.getElementById('bookControls').style.display = 'flex';
                displayCurrentPages();
            }, 1000);
        }

        function closeDiaryReader() {
            document.getElementById('diaryReader').classList.remove('active');
            currentDiaryPages = [];
            currentPageIndex = 0;
        }

        function displayCurrentPages() {
            const leftPage = document.getElementById('leftPageContent');
            const rightPage = document.getElementById('rightPageContent');
            const leftNum = document.getElementById('leftPageNumber');
            const rightNum = document.getElementById('rightPageNumber');
            
            console.log('Displaying pages, index:', currentPageIndex, 'total:', currentDiaryPages.length);
            
            // Left page
            if (currentPageIndex < currentDiaryPages.length) {
                const entry = currentDiaryPages[currentPageIndex];
                leftPage.innerHTML = `
                    <div class="page-date">${entry.dateFormatted}</div>
                    ${entry.content}
                `;
                leftNum.textContent = currentPageIndex + 1;
            } else {
                leftPage.innerHTML = '<p style="text-align: center; opacity: 0.5; margin-top: 50%; font-family: Playfair Display; font-size: 1.5rem;">The End</p>';
                leftNum.textContent = '';
            }
            
            // Right page
            if (currentPageIndex + 1 < currentDiaryPages.length) {
                const entry = currentDiaryPages[currentPageIndex + 1];
                rightPage.innerHTML = `
                    <div class="page-date">${entry.dateFormatted}</div>
                    ${entry.content}
                `;
                rightNum.textContent = currentPageIndex + 2;
            } else {
                rightPage.innerHTML = '';
                rightNum.textContent = '';
            }
            
            // Update controls
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            
            if (prevBtn) prevBtn.disabled = currentPageIndex === 0;
            if (nextBtn) nextBtn.disabled = currentPageIndex >= currentDiaryPages.length - 2;
            
            const indicator = document.getElementById('pageIndicator');
            if (indicator) {
                const endPage = Math.min(currentPageIndex + 2, currentDiaryPages.length);
                indicator.textContent = `Page ${currentPageIndex + 1}-${endPage} of ${currentDiaryPages.length}`;
            }
        }

        function nextPage() {
            console.log('Next page clicked');
            if (currentPageIndex < currentDiaryPages.length - 2) {
                // Animate page turn
                const rightPage = document.getElementById('rightPage');
                rightPage.style.transition = 'transform 0.6s ease-in-out';
                rightPage.style.transformOrigin = 'left center';
                rightPage.style.transform = 'rotateY(-180deg)';
                
                setTimeout(() => {
                    currentPageIndex += 2;
                    displayCurrentPages();
                    rightPage.style.transition = 'none';
                    rightPage.style.transform = 'rotateY(0deg)';
                }, 600);
            }
        }

        function previousPage() {
            console.log('Previous page clicked');
            if (currentPageIndex > 0) {
                // Animate page turn back
                const leftPage = document.getElementById('leftPage');
                leftPage.style.transition = 'transform 0.6s ease-in-out';
                leftPage.style.transformOrigin = 'right center';
                leftPage.style.transform = 'rotateY(180deg)';
                
                setTimeout(() => {
                    currentPageIndex -= 2;
                    displayCurrentPages();
                    leftPage.style.transition = 'none';
                    leftPage.style.transform = 'rotateY(0deg)';
                }, 600);
            }
        }

        // Helper function to adjust color brightness
        function adjustColorBrightness(color, percent) {
            const num = parseInt(color.replace("#",""), 16);
            const amt = Math.round(2.55 * percent);
            const R = (num >> 16) + amt;
            const G = (num >> 8 & 0x00FF) + amt;
            const B = (num & 0x0000FF) + amt;
            return "#" + (0x1000000 + (R<255?R<1?0:R:255)*0x10000 +
                (G<255?G<1?0:G:255)*0x100 +
                (B<255?B<1?0:B:255))
                .toString(16).slice(1);
        }
    </script>
</body>
</html>
